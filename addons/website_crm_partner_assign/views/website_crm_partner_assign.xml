<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>


    <!-- Layout add nav and footer -->
    <template id="footer_custom" inherit_id="website.layout" name="Footer Partners Link">
        <xpath expr="//footer//div[@name='info']/ul" position="inside">
            <li><a t-href="/partners/">Partners</a></li>
        </xpath>
    </template>

    <!-- Page --> 
    <template id="layout" name="Partners Layout">
        <t t-call="website.layout">
            <t t-set="additional_title">Partners</t>
            <div id="wrap">
                <div class="oe_structure"/>
                <div class="container">
                    <div class="row">
                        <t t-raw="ref_content" />
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="index" name="Find Partners">
        <t t-call="website_crm_partner_assign.layout">
            <t t-set="ref_content">
                <h1 class="col-md-12 text-center">
                    Want services on OpenERP?<br/>
                    <small>Contact a local partner</small>
                </h1>
                <div class="col-md-4" id="partner_left">
                    <h3>Partners by Country</h3>
                    <ul class="nav nav-pills nav-stacked mt16">
                        <t t-foreach="countries" t-as="country_dict">
                            <t t-if="country_dict['country_id']">
                                <li t-att-class="country_dict['country_id'][0] == current_country_id and 'active' or ''">
                                    <a t-href="/partners/country/#{ country_dict['country_id'][0] }">
                                        <t t-esc="country_dict['country_id'][1]"/> <small>(<t t-esc="country_dict['country_id_count']"/>)</small>
                                    </a>
                                </li>
                            </t>
                        </t>
                    </ul>
                </div>
                <div class="col-md-8" id="ref_content">
                    <div class='navbar'>
                        <div>
                            <t t-call="website.pager">
                               <t t-set="classname">pull-left</t>
                            </t>
                            <form t-action="/partners/" method="get" class="navbar-search pull-right pagination form-inline">
                                <div class="form-group">
                                    <input type="text" name="search" class="search-query col-md-2 mt4 form-control" placeholder="Search" t-att-value="name_search"/>
                                </div>
                                <div class="form-group">
                                    <select class="search-query col-md-2 mt4 form-control" name="grade" t-if="len(grades) > 1" onchange="submit()">
                                        <t t-foreach="grades">
                                            <t t-if="grade_id">
                                                <option t-att-selected="searches.get('grade') == str(grade_id and grade_id[0]) and 'selected'" t-att-value="grade_id[0]">
                                                    <t t-esc="grade_id[1]"/> (<t t-esc="grade_id_count"/>)
                                                </option>
                                            </t>
                                        </t>
                                    </select>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div>
                        <t t-foreach="partners" t-as="partner_id">
                            <t t-if="internal_gid != partner_id.grade_id.id">
                                <t t-set="internal_gid" t-value="partner_id.grade_id.id"/>
                                <h3 class="text-center">
                                    <span t-field="partner_id.grade_id"/> Partners
                                    <t t-if="current_country"> in <t t-esc="current_country.name"/></t>
                                </h3>
                            </t>
                            <div class="media thumbnail" data-publish="">
                                <t t-call="website.publish_management"><t t-set="object" t-value="partner_id"/></t>
                                <a class="pull-left" t-href="/partners/#{ partner_id.id }/">
                                    <img class="media-object" t-att-src="partner_id.img('image_small')"/>
                                </a>
                                <div class="media-body" style="min-height: 64px;">
                                    <a class="media-heading" t-href="/partners/#{ partner_id.id }/"><span t-field="partner_id.parent_id"/> <span t-field="partner_id.name"/></a> <t t-if="partner_id.grade_id"> - <span t-field="partner_id.grade_id"/> </t>
                                    <t t-if="partner_id.website_short_description"><div t-field="partner_id.website_short_description"/></t>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </t>
        </t>
    </template>

    <template id="ref_country" inherit_id="website_crm_partner_assign.index" inherit_option_id="website_crm_partner_assign.index" name="Left World Map">
        <xpath expr="//div[@id='partner_left']//ul" position="after">
            <h3>World Map</h3>
            <ul class="nav">
                <iframe t-attf-src="/google_map/?width=320&amp;height=240&amp;partner_ids=#{ google_map_partner_ids }&amp;partner_url=/partners/"
                    style="width:320px; height:260px; border:0; padding:0; margin:0;"></iframe>
            </ul>
        </xpath>
    </template>

    <template id="partner" name="Partner Detail">
        <t t-call="website_crm_partner_assign.layout">
            <t t-set="ref_content">
                <t t-call="website_partner.partner_detail"/>
            </t>
        </t>
    </template>

 </data>
</openerp>
