<?xml version="1.0"?>
<openerp>
    <data>

        <menuitem id="base.menu_mail_gateway" name="Emails"
            parent="base.menu_base_config" sequence="1" />

        <record model="ir.ui.view" id="view_email_message_form">
          <field name="name">email.message.form</field>
            <field name="model">email.message</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
             <form string="Email message">
                    <group colspan="4" col="6">
                        <field name="name" widget="char" string="Subject" required="1"/>
                        <field name="date" required="1"/>
                        <field name="user_id" string="Owner"/>
                        <field name="partner_id" readonly="1" />
                    </group>
                    <notebook colspan="4">
                        <page string="Details">
                            <group col="2" colspan="2">
                                <separator string="Email Followers" colspan="4"/>
                                <field name="email_from" />
                                <field name="email_to"/>
                                <field name="email_cc"/>
                                <field name="email_bcc" groups="base.group_extended"/>
                                <field name="reply_to"/>
                           </group>
                           <group col="2" colspan="2">
                                <separator string="Message Details" colspan="4"/>
                                <field name="model" readonly="1"/>
                                <group col="3" colspan="2">
                                    <field name="res_id"  readonly="1"/>
                                    <button name="open_document" string="Open Document" type="object" icon="gtk-jump-to"/>
                                </group>
                                <field name="message_id"/>
                           </group>
                        </page>
                        <page string="Attachments">
                            <separator string="Attachments" colspan="4"/>
                            <field name="attachment_ids" nolabel="1" colspan="4" readonly="1"/>
                        </page>
                        <page string="Advanced">
                            <field name="account_id" colspan="2" />
                            <field name="folder" colspan="2" select="2"/>
                            <field name="state"/>
                            <field name="sub_type"/>
                            <field name="x_headers"/>
                            <field name="priority"/>
                            <field name="debug"/>
                            <button name="process_queue" string="Process Queue" type="object" icon="gtk-action"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_email_message_tree">
            <field name="name">email.message.tree</field>
            <field name="model">email.message</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Emails">
                    <field name="date" />
                    <field name="name" string="Subject"/>
                    <field name="email_from" string="From"/>
                    <field name="user_id" string="Owner"/>
                    <field name="message_id" string="Message" invisible="1"/>
                    <field name="partner_id" invisible="1"/>
                    <button name="open_document" string="Open Document" type="object" icon="gtk-jump-to"/>
                    <button name="open_attachment" string="Open Attachments" type="object" icon="gtk-jump-to"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="view_email_message_search">
            <field name="name">email.message.search</field>
            <field name="model">email.message</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Email Search">
                    <field name="name" string="Subject"/>
                    <field name="date" />
                    <field name="user_id" string="Owner"/>
                    <field name="partner_id" string="Partner Name"/>
                    <newline/>
                    <group expand="0" string="Group By..." groups="base.group_extended">
                        <filter string="Partner" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="Owner" name="User" icon="terp-personal" context="{'group_by':'user_id'}"/>
                        <separator orientation="vertical"/>
                         <filter string="Thread" icon="terp-mail-" domain="[]" context="{'group_by':'message_id'}"/>
                         <separator orientation="vertical"/>
                         <filter string="Month" help="Creation Month" icon="terp-go-month" domain="[]" context="{'group_by':'date'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_view_mail_message" model="ir.actions.act_window">
            <field name="name">Messages</field>
            <field name="res_model">email.message</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_email_message_search"/>
        </record>

        <act_window domain="[('partner_id', '=', active_id), ('history', '=', True)]"
            id="act_res_partner_emails" name="Emails"
            res_model="email.message"
            src_model="res.partner"
            view_id="view_email_message_tree"/>

	    <act_window
	       id="act_res_partner_open_email" name="Attachments"
	       res_model="ir.attachment"
	       src_model="email.message"
	       domain="[('res_id', '=', res_id),('res_model','=',model)]"/>

        <menuitem name="Email Template" id="menu_email_template_tools"
            parent="base.menu_tools" />

        <menuitem name="Emails"
            id="menu_email_message"
            parent="menu_email_template_tools"
            action="action_view_mail_message" />


        <menuitem name="Marketing" icon="terp-crm" id="base.marketing_menu" sequence="17"/>
        <menuitem name="Emails" id="base.menu_emails" parent="base.marketing_menu" sequence="5"/>
        <menuitem name="Email Smtp Server" id="menu_email_smtp" parent="base.menu_emails"/>

        <record model="ir.ui.view" id="email_smtp_server_form">
            <field name="name">email.smtp_server.form</field>
            <field name="model">email.smtp_server</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Email Smtp Server Configuration">
                    <group colspan="2">
                        <field name="name" select="1" />
                        <field name="default"/>
                    </group>
                    <notebook colspan="4">
                        <page string="Outgoing">
                            <separator string="Server Information" colspan="4" />
                            <group colspan="4" col="4">
                                <field name="smtpserver" select="1"/>
                                <button name="check_outgoing_connection" type="object" string="Test Outgoing Connection" icon="gtk-network" colspan="2"/>
                                <field name="smtpport" select="2" />
                                <field name="smtpssl" select="2" />
                                <field name="smtptls" select="2" />
                            </group>
                            <separator string="User Information" colspan="4" />
                            <group col="2" colspan="2">
                                <field name="email_id" select="1" colspan="2" />
                                <field name="smtppass" password="True" colspan="2" />
                            </group>
                            <group col="2" colspan="2">
                                <field name="smtpuname" select="1" colspan="2" />
                            </group>
                        </page>
                    </notebook>
                    <group colspan="4" col="10">
                        <field name="state" select="1"/>
                        <button string="Approve Account" name="button_approval" states="draft" type="workflow" icon="terp-camera_test"/>
                        <button string="Suspend Account" name="button_suspended" states="approved" type="workflow" icon="gtk-cancel"/>
                        <button string="Request Re-activation" name="get_reapprove" states="suspended" type="workflow" icon="gtk-convert"/>
                        <button string="Send/Receive" name="send_receive" states="approved" type="object" icon="terp-check"/>
                    </group>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="email_smtp_server_tree">
            <field name="name">email.smtp_server.tree</field>
            <field name="model">email.smtp_server</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree colors="blue:state in ('draft');black:state in ('suspended','approved')" string="Email Accounts">
                    <field name="name" />
                    <field name="email_id" />
                    <field name="smtpuname" />
                    <field name="smtpserver" />
                    <field name="smtpport" />
                    <field name="state" />
                </tree>
            </field>
        </record>

       <record id="view_email_smtp_server_search" model="ir.ui.view">
           <field name="name">email_smtp.server.search</field>
           <field name="model">email.smtp_server</field>
           <field name="type">search</field>
           <field name="arch" type="xml">
               <search string="Email Smtp Server">
                    <filter icon="terp-document-new" string="Draft" name="draft" domain="[('state','=','draft')]"/>
                    <filter icon="terp-camera_test" string="Approved" domain="[('state','=','approved')]"/>
                    <filter icon="terp-emblem-important" string="Suspended" domain="[('state','=','suspended')]"/>
                    <separator orientation="vertical"/>
                    <field name="name" select="1"/>
                    <field name="email_id" select="1"/>
               </search>
           </field>
        </record>

        <record model="ir.actions.act_window" id="action_email_smtp_server_tree_all">
            <field name="name">Smtp Server</field>
            <field name="res_model">email.smtp_server</field>
            <field name="view_type">form</field>
            <field name="view_mode">form,tree</field>
            <field name="view_id" ref="email_smtp_server_tree" />
            <field name="context">{'group_by': [], 'search_default_draft': 1, 'search_default_my': 1}</field>
            <field name="search_view_id" ref="view_email_smtp_server_search"/>
        </record>

        <menuitem name="Configuration" parent="base.marketing_menu"
            id="base.menu_marketing_config_root" sequence="20" groups="base.group_system"/>

        <menuitem name="Email Template" id="menu_email_template_configuration" parent="base.menu_marketing_config_root" />

        <menuitem name="Email Smtp Server" id="menu_email_smtp_server_all" parent="menu_email_template_configuration" action="action_email_smtp_server_tree_all"/>

        <menuitem name="Configuration" parent="base.menu_tools"
              id="base.menu_lunch_survey_root" sequence="20" />

        <menuitem name="Email Template" id="menu_email_template_config_tools"
            parent="base.menu_lunch_survey_root" />

        <menuitem name="Email Smtp Server" id="menu_email_account_all_tools"
            parent="menu_email_template_config_tools" action="action_email_smtp_server_tree_all" />


    </data>
</openerp>
