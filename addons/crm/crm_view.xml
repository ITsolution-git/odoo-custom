<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <menuitem id="menu_crm_configuration" name="Cases" parent="base.menu_base_config" sequence="0"/>

<!-- Case Sections Form View -->

        <record id="crm_case_section_view_form" model="ir.ui.view">
            <field name="name">crm.case.section.form</field>
            <field name="model">crm.case.section</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Case Section">
                    <notebook>
                        <page string="Case section">
                            <field name="name" select="1"/>
                            <field name="code" select="1"/>
                            <field name="user_id" select="2"/>
                            <field name="active" select="2"/>
                            <field name="parent_id" select="2" widget="selection"/>
                            <field name="allow_unlink" select="2"/>
                            <field name="reply_to" select="2"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

<!-- Case Sections Tree View -->

        <record id="crm_case_section_view_tree" model="ir.ui.view">
            <field name="name">crm.case.section.tree</field>
            <field name="model">crm.case.section</field>
            <field name="type">tree</field>
            <field name="field_parent">child_ids</field>
            <field name="arch" type="xml">
                <tree string="Case Section">
                    <field name="name" select="1"/>
                    <field name="code" select="1"/>
                    <field name="user_id" select="1"/>
                </tree>
            </field>
        </record>

<!-- Case Sections Action -->

        <record id="crm_case_section_act" model="ir.actions.act_window">
            <field name="name">Sections</field>
            <field name="res_model">crm.case.section</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="crm_case_section_view_tree"/>
        </record>

<!-- CRM Stage Tree View -->

        <record model="ir.ui.view" id="crm_case_stage_tree">
            <field name="name">crm.case.stage.tree</field>
            <field name="model">crm.case.stage</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Stages">
                    <field name="sequence"/>
                    <field name="name"/>
                    <field name="probability"/>
                    <field name="section_id"/>

                </tree>
            </field>
        </record>

<!-- CRM Stage Form View -->

        <record model="ir.ui.view" id="crm_case_stage_form">
            <field name="name">crm.case.stage.form</field>
            <field name="model">crm.case.stage</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Stage">
                    <separator string="Stage Definition" colspan="4"/>
                    <field name="name" select="1"/>
                    <field name="section_id" select="1" widget="selection"/>
                    <field name="object_id" invisible="1" />
                    <field name="sequence"/>
                    <field name="probability"/>
                    <field name="on_change"/>
                    <separator string="Requirements" colspan="4"/>
                    <field name="requirements" nolabel="1" colspan="4"/>
                </form>
            </field>
        </record>

<!-- CRM Stage Action -->

        <record id="crm_case_stage_act" model="ir.actions.act_window">
            <field name="name">Stages</field>
            <field name="res_model">crm.case.stage</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="crm_case_stage_tree"/>
        </record>

        <menuitem  id="menu_crm_case_stage" name="Stages" parent="crm.menu_crm_configuration"/>


<!-- Case Categories Form View -->

        <record id="crm_case_categ-view" model="ir.ui.view">
            <field name="name">crm.case.categ.form</field>
            <field name="model">crm.case.categ</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Case Category">
                    <field name="name" select="1"/>
                    <field name="section_id" select="1" widget="selection"/>
                    <field name="object_id"  invisible="1" />
                </form>
            </field>
        </record>

<!-- Case Categories Tree View -->

        <record id="crm_case_categ_tree-view" model="ir.ui.view">
            <field name="name">crm.case.categ.tree</field>
            <field name="model">crm.case.categ</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Case Category">
                    <field name="name"/>
                    <field name="section_id"/>
                </tree>
            </field>
        </record>

<!-- Case Categories Action -->

        <record id="crm_case_categ-act" model="ir.actions.act_window">
            <field name="name">Categories</field>
            <field name="res_model">crm.case.categ</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="crm_case_categ_tree-view"/>
        </record>
        <menuitem id="menu_crm_case_categ"   name="Categories"  parent="crm.menu_crm_configuration"/>

        <menuitem action="crm_case_section_act"
            id="menu_crm_case_section_act"
            parent="crm.menu_crm_configuration" />


<!-- Resource Type of case Tree View -->

        <record model="ir.ui.view" id="crm_case_resource_type_tree">
            <field name="name">crm.case.resource.type.tree</field>
            <field name="model">crm.case.resource.type</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Resource Type">
                    <field name="name"/>
                    <field name="object_id"/>
                    <field name="section_id"/>
                </tree>
            </field>
        </record>

<!-- Resource Type of case Form View -->

        <record model="ir.ui.view" id="crm_case_resource_type_form">
            <field name="name">crm.case.resource.type.form</field>
            <field name="model">crm.case.resource.type</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Resource Type">
                    <field name="name" select="1"/>
                    <field name="section_id" select="1" widget="selection"/>
                    <field name="object_id"  />
                </form>
            </field>
        </record>

<!-- Resource Type of case Action -->

        <record id="crm_case_resource_type_act" model="ir.actions.act_window">
            <field name="name">Resource Type</field>
            <field name="res_model">crm.case.resource.type</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="crm_case_resource_type_tree"/>
        </record>
        <menuitem id="menu_crm_case_resource_type" name="Resource Type"
            parent="crm.menu_crm_configuration" />

        <record id="crm_case_section_act_tree" model="ir.actions.act_window">
            <field name="name">Cases by section</field>
            <field name="res_model">crm.case.section</field>
            <field name="domain">[('parent_id','=',False)]</field>
            <field name="view_type">tree</field>
            <field name="view_id" ref="crm_case_section_view_tree"/>
        </record>

<!-- Cases Tree View  -->

        <record id="crm_case_log_tree-view" model="ir.ui.view">
            <field name="name">crm.case.log.tree</field>
            <field name="model">crm.case.log</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Case logs">
                    <field name="date"/>
                    <field name="name"/>
                    <field name="user_id"/>
                    <field name="section_id"/>
                    <!--
                    <field name="som"/>
                    <field name="canal_id"/>
                    -->
                </tree>
            </field>
        </record>

<!--Case History Tree View  -->

        <record id="crm_case_history_tree-view" model="ir.ui.view">
            <field name="name">crm.case.history.tree</field>
            <field name="model">crm.case.history</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Case History">
                    <field name="date"/>
                    <field name="name"/>
                    <field name="user_id"/>
                    <!--
                    <field name="som"/>
                    <field name="canal_id"/>
                    -->
                </tree>
            </field>
        </record>

<!-- Case Calendar View  -->

        <record id="crm_case_calendar-view" model="ir.ui.view">
            <field name="name">crm.case.calendar</field>
            <field name="model">crm.case</field>
            <field name="type">calendar</field>
            <field name="arch" type="xml">
                <calendar color="user_id" date_start="create_date"
                    date_stop="date_deadline" day_length="12"
                    string="Cases">
                    <field name="name" />
                    <field name="partner_id" />
                    <field name="state" />
                </calendar>
            </field>
        </record>

<!-- Case Tree View  -->

        <record id="crm_case_tree-view" model="ir.ui.view">
            <field name="name">crm.case.tree</field>
            <field name="model">crm.case</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree colors="red:date_deadline&lt;current_date and state=='open';black:state in ('draft', 'cancel','done','pending')" string="Cases">
                    <field name="id"/>
                    <field name="section_id"/>
                    <field name="create_date"/>
                    <field name="date_deadline"/>
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="user_id"/>
                    <field name="state"/>
                    <button name="case_close"
                        states="open,draft,pending" string="Close"
                        type="object" icon="gtk-close" />
                    <button name="case_open" states="draft,pending"
                        string="Open" type="object" icon="gtk-go-forward" />
                    <button name="case_cancel"
                        states="draft,open,pending" string="Cancel"
                        type="object" icon="gtk-cancel" />
                    <button name="case_pending" states="draft,open"
                        string="Pending" type="object"
                        icon="gtk-media-pause" />
                    <button name="case_escalate"
                        states="open,draft,pending" string="Escalate"
                        type="object" icon="gtk-go-up" />
                    <button name="case_reset" states="done,cancel"
                        string="Reset to Draft" type="object"
                        icon="gtk-convert" />
                </tree>
            </field>
        </record>

<!-- Case Form View  -->

        <record id="crm_case-view" model="ir.ui.view">
            <field name="name">crm.case.form</field>
            <field name="model">crm.case</field>
            <field name="type">form</field>
            <field name="priority" eval="1"/>
            <field name="arch" type="xml">
                <form string="Cases">
                    <field colspan="4" name="name" select="1"/>
                    <field colspan="2" name="section_id" widget="selection"/>
                    <field name="create_date" select="1"/>
                    <field name="date_deadline" select="2"/>
                    <newline />
                    <notebook colspan="4">
                        <page string="General">
                            <group col="8" colspan="4">
                                <field colspan="4" name="partner_id"
                                    on_change="onchange_partner_id(partner_id, email_from)"
                                    select="1" />
                                <field colspan="3"
                                    name="partner_address_id"
                                    on_change="onchange_partner_address_id(partner_address_id, email_from)"
                                    select="2" />
                                <newline />
                                <field colspan="3" name="email_from"
                                    select="2" />
                                <button name="remind_partner"
                                    states="open,pending"
                                    string="Send Reminder" type="object"
                                    icon="gtk-go-forward" />
                                <field name="user_id" select="1" />
                                <button name="remind_user"
                                    states="open,pending"
                                    string="Send Reminder" type="object"
                                    icon="gtk-go-forward" />
                            </group>
                            <separator colspan="4" string="Description"/>
                            <field name="description" colspan="4" nolabel="1"/>
                            <separator colspan="4"/>
                            <group col="8" colspan="4">
                                <field name="state" select="1"/>
                                <button name="case_close"
                                    states="open,draft,pending"
                                    string="Close" type="object"
                                    icon="gtk-close" />
                                <button name="case_open"
                                    states="draft,pending" string="Open"
                                    type="object" icon="gtk-go-forward" />
                                <button name="case_cancel"
                                    states="draft,open,pending"
                                    string="Cancel" type="object"
                                    icon="gtk-cancel" />
                                <button name="case_pending"
                                    states="draft,open" string="Pending"
                                    type="object" icon="gtk-media-pause" />
                                <button name="case_escalate"
                                    states="open,draft,pending"
                                    string="Escalate" type="object"
                                    icon="gtk-go-up" />
                                <button name="case_reset"
                                    states="done,cancel"
                                    string="Reset to Draft" type="object"
                                    icon="gtk-convert" />
                            </group>
                        </page>
                        <page string="History" groups="base.group_extended">
                            <field name="id" select="1"/>
                            <field name="active" select="2"/>
                            <separator colspan="4" string="Dates"/>
                            <field name="create_date"/>
                            <field colspan="4" name="log_ids" nolabel="1">
                                <form string="Actions">
                                    <separator colspan="4" string="Action Information"/>
                                    <field colspan="4" name="name"/>
                                    <field name="date" select="2"/>
                                    <field name="user_id" select="2"/>                                    
                                </form>
                            </field>
                        </page>
                        <page string="Emails" groups="base.group_extended">
                           <group colspan="4">
                               <field colspan="4" name="email_cc" string="CC"/>
                           </group>
                           <field name="history_line" colspan="4" nolabel="1" mode="form,tree">
                               <form string="Communication history">
                                   <group col="7" colspan="4">
                                       <field name="date"/>
                                       <field name="email_to"/>
                                       <field name="email_from"/>                                       
                                       <button
                                     string="Add a CC"
                                               name="%(crm.action_view_crm_email_add_cc_wizard)d"
                                               icon="gtk-add" type="action"/>
                                   </group>
                                   <newline/>
                                   <field name="description" colspan="4" nolabel="1"/>
                                   <button colspan="4"
                                       string="Reply to Last Email"
                                       name="%(action_crm_send_mail)d"
                                       context="{'mail':'reply', 'model': 'crm.case'}"
                                       icon="gtk-undo" type="action" />
                               </form>
                               <tree string="Communication history">
                                   <field name="description"/>
                                   <field name="email_to"/>
                                   <field name="date"/>
                               </tree>
                           </field>
                           <button colspan="4" string="Send New Email"
                               name="%(action_crm_send_mail)d"
                               context="{'mail':'new', 'model': 'crm.case'}"
                               icon="gtk-go-forward" type="action" />
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

<!-- Case Search View  -->

        <record id="view_crm_case_filter" model="ir.ui.view">
            <field name="name">crm.case.select</field>
            <field name="model">crm.case</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Case">
                    <group col='6' colspan='4'>
                        <filter icon="terp-partner" string="My Cases"
                            domain="[('user_id','=',uid)]" separator="1"
                            default="1" help="Cases Related to Current User" />
                        <field name="state" select="1">
                            <filter icon="gtk-new"
                                domain="[('state','in',('draft', 'open'))]"
                                help="Current Cases" />
                            <filter icon="gtk-yes"
                                domain="[('state','=','open')]" help="Open Cases" />
                            <filter icon="gtk-media-pause"
                                domain="[('state','=','pending')]"
                                help="Pending Cases" />
                        </field>
                        <separator orientation="vertical" />
                        <field name="name" select='1' />
                        <field name="user_id" select="1"
                            widget="selection" />
                    </group>
                    <field name="section_id"
                        default="context.get('section_id', False)" select="1"
                        widget="selection"/>
                </search>
            </field>
        </record>

        <record id="crm_case_categ0-act" model="ir.actions.act_window">
            <field name="name">Cases</field>
            <field name="res_model">crm.case</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="crm_case_tree-view"/>
            <field name="search_view_id" ref="view_crm_case_filter"/>
        </record>

        <record id="crm_case_categ0-act_open" model="ir.actions.act_window">
            <field name="name">Open Cases</field>
            <field name="res_model">crm.case</field>
            <field name="view_type">form</field>
            <field name="domain">
                [('state','&lt;&gt;','done'),('state','&lt;&gt;','cancel'),('state','&lt;&gt;','pending')]
            </field>
            <field name="search_view_id" ref="view_crm_case_filter"/>
        </record>

        <record id="crm_case_section_open_act" model="ir.actions.act_window">
            <field name="name">Cases</field>
            <field name="res_model">crm.case</field>
            <field name="domain">[('section_id','child_of',[active_id])]</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar</field>
        </record>
        <record id="ir_open_section_case" model="ir.values">
            <field eval="'tree_but_open'" name="key2"/>
            <field eval="'crm.case.section'" name="model"/>
            <field name="name">Open Cases</field>
            <field eval="'ir.actions.act_window,%d'%crm_case_section_open_act" name="value"/>
            <field eval="True" name="object"/>
        </record>

<!--Case History Form View  -->

        <record id="crm_case_history-view" model="ir.ui.view">
            <field name="name">crm.case.history.form</field>
            <field name="model">crm.case.history</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Cases">
                    <separator colspan="4" string="Case Description"/>
                    <field colspan="4" name="name" select="1"/>
                    <field name="date" select="1"/>
                    <field name="user_id" select="1"/>
                    <field name="model_id" select="2"/>
                    <field name="res_id" select="2"/>
                    <field name="som" select="2"/>
                    <field name="canal_id" select="2"/>
                    <field colspan="4" name="description" select="2"/>
                </form>
            </field>
        </record>

<!--Case History Search View  -->

        <record id="crm_case_history_search" model="ir.ui.view">
        <field name="name">crm.case.history.select</field>
        <field name="model">crm.case.history</field>
        <field name="type">search</field>
        <field name="arch" type="xml">
                <search string="Search Histories">
                       <filter icon="terp-crm" string="My Histories"
                           domain="[('user_id','=',uid)]"
                           help="My Histories" />
                       <separator orientation="vertical"/>
                     <group col="6" colspan="2">
                       <field name="date" select="1"/>
                    <field name="user_id" select="1" widget="selection"/>
                    <field name="section_id"
                        default="context.get('section_id', False)"
                        select="1" widget="selection"/>
                     </group>
                </search>
            </field>
        </record>

<!--Case History Action -->

        <record id="crm_case_history-act" model="ir.actions.act_window">
            <field name="name">Histories</field>
            <field name="res_model">crm.case.history</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="crm_case_history_tree-view"/>
            <field name="search_view_id" ref="crm_case_history_search"/>
        </record>

<!-- Segmentation line Tree View  -->

        <record id="crm_segmentation_line_tree-view" model="ir.ui.view">
            <field name="name">crm.segmentation.line.tree</field>
            <field name="model">crm.segmentation.line</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Partner Segmentation Lines">
                    <field name="name"/>
                    <field name="expr_name"/>
                    <field name="expr_operator"/>
                    <field name="expr_value"/>
                    <field name="operator"/>
                </tree>
            </field>
        </record>

<!-- Segmentation line Form View  -->

        <record id="crm_segmentation_line-view" model="ir.ui.view">
            <field name="name">crm.segmentation.line.form</field>
            <field name="model">crm.segmentation.line</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Partner Segmentation Lines">
                    <field colspan="4" name="name" select="1"/>
                    <group col="2" colspan="4">
                        <field name="expr_name" select="2"/>
                        <field name="expr_operator" select="2"/>
                        <field name="expr_value" select="2"/>
                    </group>
                    <newline/>
                    <field name="operator"/>
                </form>
            </field>
        </record>

<!-- CRM Segmentation  Form View  -->

        <record id="crm_segmentation-view" model="ir.ui.view">
            <field name="name">crm.segmentation.form</field>
            <field name="model">crm.segmentation</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Partner Segmentation">
                    <group col="6" colspan="4">
                        <field name="name" select="1"/>
                        <field name="categ_id" select="2"/>
                        <field name="exclusif"/>
                    </group>
                    <notebook colspan="4">
                        <page string="Sales Purchase">
                            <field name="sales_purchase_active"/>
                            <separator colspan="4" string="State of Mind Computation"/>
                            <field name="som_interval"/>
                            <field name="som_interval_max"/>
                            <field name="som_interval_decrease"/>
                            <field name="som_interval_default"/>
                            <separator colspan="4" string="Segmentation Test"/>
                            <field colspan="4" name="segmentation_line" widget="one2many_list" nolabel="1"/>
                        </page>
                        <page string="Description">
                               <field colspan="4" name="description" select="2" nolabel="1"/>
                           </page>
                    </notebook>
                    <field name="state"/>
                    <group col="3" colspan="2">
                        <button name="process_start"
                            states="not running"
                            string="Compute Segmentation" type="object"
                            icon="gtk-execute" />
                        <button name="process_stop" states="running"
                            string="Stop Process" type="object"
                            icon="gtk-cancel" />
                        <button name="process_continue" states="running"
                            string="Continue Process" type="object"
                            icon="gtk-go-forward" />
                    </group>
                </form>
            </field>
        </record>

<!-- CRM Segmentation  Tree View  -->

        <record id="crm_segmentation_tree-view" model="ir.ui.view">
            <field name="name">crm.segmentation.tree</field>
            <field name="model">crm.segmentation</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Partner Segmentations">
                    <field name="name"/>
                    <field name="description"/>
                    <field name="categ_id"/>
                </tree>
            </field>
        </record>

        <record id="crm_segmentation-act" model="ir.actions.act_window">
            <field name="name">Segmentations</field>
            <field name="res_model">crm.segmentation</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="crm_segmentation-view"/>
        </record>

        <record id="crm_segmentation_tree-act" model="ir.actions.act_window">
            <field name="name">Segmentations</field>
            <field name="res_model">crm.segmentation</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>
        <menuitem action="crm_segmentation_tree-act"
            id="menu_crm_segmentation-act"
            parent="crm.menu_crm_configuration" />

        <record model="ir.ui.view" id="view_users_form_simple_modif_inherited1">
            <field name="name">view.users.form.crm.modif.inherited1</field>
            <field name="model">res.users</field>
            <field name="inherit_id" ref="base.view_users_form_simple_modif" />
            <field name="type">form</field>
            <field name="arch" type="xml">
                <page string="Current Activity" position="inside">
                    <field name="context_section_id" completion="1"
                        widget="selection"
                        context="{'user_prefence':True}" />
                </page>
            </field>
        </record>

        <record id="view_users_form_simple_modif_inherited2" model="ir.ui.view">
                <field name="name">view.users.form.crm.modif.inherited2</field>
                <field name="model">res.users</field>
                <field name="type">form</field>
                <field name="inherit_id" ref="base.view_users_form"/>
                <field eval="18" name="priority"/>
                <field name="arch" type="xml">
                    <field name="password" position="after">
                    <field name="context_section_id" completion="1" widget="selection"/>
                    </field>
                </field>
        </record>

<!-- Inherit View From Partner  -->

        <record id="view_partners_form_crm1" model="ir.ui.view">
                <field name="name">view.res.partner.form.crm.inherited1</field>
                <field name="model">res.partner</field>
                <field name="type">form</field>
                <field name="inherit_id" ref="base.view_partner_form"/>
                <field eval="18" name="priority"/>
                <field name="arch" type="xml">
                    <field name="parent_id" position="after">
                    <field name="section_id" completion="1" widget="selection"/>
                    </field>
                </field>
        </record>

        <record id="view_partners_form_crm2" model="ir.ui.view">
                <field name="name">view.res.partner.form.crm.inherited2</field>
                <field name="model">res.partner</field>
                <field name="type">form</field>
                <field name="inherit_id" ref="base.view_partner_tree"/>
                <field eval="18" name="priority"/>
                <field name="arch" type="xml">
                    <field name="lang" position="after">
                    <field name="section_id" completion="1" widget="selection"/>
                    </field>
                </field>
        </record>

        <record id="view_partners_form_crm3" model="ir.ui.view">
                <field name="name">view.res.partner.form.crm.inherited3</field>
                <field name="model">res.partner</field>
                <field name="type">form</field>
                <field name="inherit_id" ref="base.view_res_partner_filter"/>
                <field eval="18" name="priority"/>
                <field name="arch" type="xml">
                    <field name="category_id" position="after">
                        <field name="section_id" completion="1" widget="selection"/>
                    </field>
                </field>
        </record>
    </data>
</openerp>
