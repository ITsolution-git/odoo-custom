-
  Convert opportunity based on exiting partner.
-
  !python {model: crm.lead}: |
    self.convert_opportunity(cr, uid ,[ref("crm_case_qrecorp0")], ref("base.res_partner_agrolait"))
-
  After converted in opportunity, i test that lead is converted to opportunity.
-
  !python {model: crm.lead}: |
    lead = self.browse(cr, uid, ref('crm_case_qrecorp0'))
    assert lead.type == 'opportunity', 'Lead is not converted to opportunity!'
    assert lead.partner_id.id == ref("base.res_partner_agrolait"), 'Partner missmatch!'
    assert lead.stage_id.id == ref("stage_lead1"), 'Stage of opportunity is incorrect!'
-
  Finally, i won this opportunity, so i close this opportunity.
-
  !python {model: crm.lead}: |
    self.case_mark_won(cr, uid, [ref("crm_case_qrecorp0")])
-
  After wininng the opportunity , I test the opportunity.
-
  !python {model: crm.lead}: |
    lead = self.browse(cr, uid, ref('crm_case_qrecorp0'))
    assert lead.state == 'done', 'Opportunity is not in done state!'
    assert lead.stage_id.name == 'Won', ' Stage of Opportunity is not win!'
    assert lead.probability == 100.0, 'probability revenue should not  be 100.0!'
-
  I add internal note to this opportunity, so i create note.
-
  !record {model: crm.add.note, id: crm_add_note_won_opportunity}:
    body: 'I won this Opportunity'
-
  Apply this note to opportunity.
-
  !python {model: crm.add.note}: |
    self.action_add(cr, uid, [ref("crm_add_note_won_opportunity")], {"active_model": "crm.lead","active_ids": [ref("crm_case_qrecorp0")]})
-
  I test Internal latest note added on opportunity .
-
-  !python {model: crm.lead}: |
-    lead = self.browse(cr, uid, ref('crm_case_qrecorp0'))
-    assert lead.message_ids[0].subject == 'I won this Opportunity', 'Fail to Added interal note on opportunity'
