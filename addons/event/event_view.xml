<?xml version="1.0"?>
<openerp>
    <data>
        <menuitem name="Marketing" id="menu_marketing_event_main" icon="terp-calendar" sequence="9"/>
        <menuitem name="Events Organisation" id="menu_event_main" parent="menu_marketing_event_main" />
    <!-- EVENTS  -->
        <!--<menuitem name="Events Organisation" id="menu_event_main" icon="terp-calendar" />-->

    <!-- EVENTS/CONFIGURATION/TYPE OF EVENTS -->
        <record model="ir.ui.view" id="view_event_type_form">
            <field name="name">Event type</field>
            <field name="model">event.type</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Event Type">
                    <field name="name" select="1"/>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_event_type_tree">
            <field name="name">Event type</field>
            <field name="model">event.type</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Event Type">
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_event_type">
            <field name="res_model">event.type</field>
            <field name="view_type">form</field>
        </record>
        <menuitem name="Configuration" id="menu_event_config" parent="menu_marketing_event_main" sequence="30" groups="base.group_extended"/>
        <menuitem name="Types of Events" id="menu_event_type" action="action_event_type" parent="menu_event_config" groups="base.group_extended,crm.group_crm_manager"/>

        <!-- The base section for all events -->

        <record model="ir.actions.act_window" id="action_event_categories">
            <field name="name">Events by section</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">crm.case.section</field>
            <field name="domain" eval="[('parent_id','=',False)]" />
            <field name="view_type">tree</field>
        </record>
        <menuitem name="Events by Categories" id="menu_action_event_categories" action="action_event_categories" parent="menu_event_main"/>

    <!-- Events Organisation/CONFIGURATION/EVENTS -->

        <record model="ir.ui.view" id="view_event_form">
            <field name="name">Events</field>
            <field name="model">event.event</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Events">
                    <group col="6" colspan="4">
                        <field name="name" string="Event" select="1"/>
                        <field name="type"/>
                        <field name="user_id" select="1"/>
                        <field name="date_begin" select="1"/>
                        <field name="date_end"/>
                        <field name="product_id"/>
                    </group>
                    <notebook colspan="4">
                    <page string="General">
                        <separator string="Event description" colspan="4"/>
                        <field name="parent_id" domain="[('parent_id','child_of','Event')]"/>
                        <field name="active"/>
                        <field name="register_min"/>
                        <field name="register_max"/>
                        <separator string="Notes" colspan="4"/>
                        <field name="note" colspan="4" nolabel="1"/>
                        <field name="state" select="1"/>
                        <group col="4" colspan="2">
                           <button string="Confirm Event" name="button_confirm" states="draft" type="object" icon="gtk-apply"/>
                           <button string="Cancel Event" name="button_cancel" states="draft,confirm" type="object" icon="gtk-cancel"/>
                           <button string="Event Done" name="button_done" states="confirm" type="object" icon="gtk-jump-to"/>
                           <button string="Set To Draft" name="button_draft" states="confirm,cancel,done" type="object" icon="gtk-convert"/>
                        </group>
                    </page>
                   <page string="Mailing">
                        <field name="reply_to"/>
                        <newline/>

                        <group col="3" colspan="2">
                            <separator string="Auto Registration Email" colspan="2"/>
                            <newline/>
                            <field name="mail_auto_registr"/>
                            <separator string="Registration Email" colspan="2"/>
                            <field name="mail_registr" colspan="2" nolabel="1"/>
                        </group>
                        <group col="2" colspan="2">
                            <separator string="Auto Confirmation Email" colspan="2"/>
                            <field name="mail_auto_confirm"/>
                            <newline/>
                            <separator string="Confirmation Email" colspan="2"/>
                            <field name="mail_confirm" colspan="2" nolabel="1"/>
                        </group>
                    </page>
                    <page string="Statistics">
                        <separator string="Registrations" colspan="4"/>
                        <field name="register_current"/>
                        <field name="register_prospect"/>
                    </page>
                    </notebook>
            </form>
            </field>
        </record>

        <!-- event.event tree view -->
        
        <record model="ir.ui.view" id="view_event_tree">
            <field name="name">event.event.tree</field>
            <field name="model">event.event</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Events" colors="red:register_min>register_current;black:register_min&lt;=register_current">
                    <field name="name" string="Name"/>
                    <field name="user_id"/>
                    <field name="type"/>
                    <field name="date_begin"/>
                    <field name="register_min"/>
                    <field name="register_current"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="view_event_search">
            <field name="name">Events</field>
            <field name="model">event.event</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Events">
                    <group col="10" colspan="4">
                        <filter icon="terp-document-new" string="Draft" name="draft" domain="[('state','=','draft')]" help="Draft Events"/>
                        <filter icon="terp-camera_test" string="Confirmed" domain="[('state','=','confirm')]" help="Confirmed Events"/>
                        <separator orientation="vertical"/>
                        <field name="name" string="Event" select="1"/>
                        <field name="state" select="1"/>
                        <field name="user_id" widget="selection">
                               <filter icon="terp-personal"
                                    string="My Events"
                                    help="My Events"
                                    domain="[('user_id','=',uid)]"/>
                        </field>
                        <field name="date_begin" select="1"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By..." colspan="4" col="12">
                        <filter string="Event Type" icon="terp-crm"  context="{'group_by':'type'}"/>
                        <filter string="state" icon="terp-stock_effects-object-colorize" context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/> 
                        <filter string="Responsible"  icon="terp-personal" context="{'group_by': 'user_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Creation" icon="terp-go-month"
                            domain="[]" context="{'group_by':'date_begin'}"/>
                    </group>
                </search>
            </field>
        </record>

    <!-- Events Organisation/CONFIGURATION/EVENTS  -->
    
       <record model="ir.actions.act_window" id="action_event_view">
           <field name="name">Events</field>
           <field name="type">ir.actions.act_window</field>
           <field name="res_model">event.event</field>
           <field name="view_type">form</field>
           <field name="view_mode">tree,form</field>
           <field name="context">{"search_default_draft": "1"}</field>
           <field name="search_view_id" ref="view_event_search"/>
       </record>
       
      <act_window
            id="act_event_list_register_event"
            name="Registration"
            res_model="event.registration"
            src_model="event.event"
            view_mode="tree,form"
            domain="[('event_id', '=', active_id)]"
            view_type="form"/>

       <menuitem name="Events" id="menu_event_event" action="action_event_view" parent="menu_event_main" />

    <!-- EVENTS/REGISTRATIONS/EVENTS  -->

        <!-- Registration view (form) by _inherits  .................. -->
        
        <record model="ir.ui.view" id="view_event_registration_tree">
            <field name="name">event.registration.tree</field>
            <field name="model">event.registration</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Registration">
                    <field name="id"/>
                    <field name="create_date"/>
                    <field name="event_id"/>
                    <field name="partner_id"/>
                    <field name="nb_register"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="view_event_registration_form">
            <field name="name">event.registration.form</field>
            <field name="model">event.registration</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Registration">
                    <group col="6" colspan="4">
                        <field name="event_id" select="1" on_change="onchange_event(event_id, partner_invoice_id)" domain="[('state','in',('draft','confirm'))]"/>
                        <field name="nb_register"/>
                        <group colspan="2">
                            <field name="user_id" select="1"/>
                            <button name="remind_user" string="Send Reminder" states="open,pending" type="object" colspan="2" icon="gtk-go-forward"/>
                        </group>
                        <field name="partner_id" required="1" select="1" on_change="onchange_partner_id(partner_id,event_id)" />
                        <field name="partner_invoice_id" on_change="onchange_partner_invoice_id(event_id, partner_invoice_id)"/>
                        <field name="unit_price"/>
                    </group>
                    <notebook colspan="4">
                        <page string="General">
                            <field name="contact_id" on_change="onchange_contact_id(contact_id, partner_id)" /><newline/>
                            <field name="email_from"/>
                            <button name="remind_partner" string="Send Reminder" states="open,pending" type="object" colspan="2" icon="gtk-go-forward"/>
                            <newline/>
                            <separator string="Badge" colspan="4"/>
                            <field name="badge_title"/>
                            <field name="badge_name" on_change="onchange_badge_name(badge_name)"/>
                            <field name="badge_partner"/>
                            <newline/>
                            <separator string="Status" colspan="4"/>
                            <group col="8" colspan="4">
                                <field name="state" select="1" colspan="2"/>
                                <button name="button_reg_close" string="Close Registration" states="open" type="object" icon="gtk-close"/>
                                <button name="check_confirm" string="Confirm Registration" states="draft" type="object" icon="gtk-apply"/>
                                <button name="button_reg_cancel" string="Cancel Registration" states="draft,open" type="object" icon="gtk-cancel"/>
                            </group>
                        </page>
                        <page string="Payments">
                            <field name="event_product" select="1"/>
                            <field name="tobe_invoiced" select="1"/>
                            <field name="invoice_id"/>
                        </page>
                        <page string="Emails" groups="base.group_extended">
                            <group colspan="4">
                                <field colspan="4" name="email_cc" string="CC"/>
                            </group>
	                        <field name="message_ids" colspan="4" nolabel="1" mode="form,tree">
		                        <form string="Communication history">
		                            <group col="6" colspan="4">
		                                <field name="date"/>
		                                <field name="email_to"/>
		                                <field name="email_from"/>
		                            </group>
		                            <notebook colspan="4">
		                                <page string="Details">
		                                    <field name="description" colspan="4" nolabel="1"/>
		                                </page>
		                                <page string="Attachments">
		                                    <field name="attachment_ids" colspan="4" readonly="1" nolabel="1"/>
		                                </page>
		                            </notebook>
		                            <button colspan="4"
		                            string="Reply to Last Email"
		                            name="%(crm.action_crm_send_mail)d"
		                            context="{'mail':'reply', 'model': 'crm.lead', 'include_original' : True}"
		                            icon="gtk-undo" type="action" />
		                        </form>
		                        <tree string="Communication history">
		                            <field name="date"/>
		                            <field name="email_from" />
		                            <field name="email_to"/>
		                            <field name="description"/>
		                        </tree>
	                           </field>
	                          <button colspan="4" string="Send New Email"
                                name="%(crm.action_crm_send_mail)d"
                                context="{'mail':'new', 'model': 'event.registration'}"
                                icon="gtk-go-forward" type="action" />
	                       </page>
	                       <page string="History">
	                            <group colspan="4"> 
	                               <field name="name" select="1" colspan="4"/>
	                            </group>   
	                            <group col="2" colspan="2">
	                               <separator string="Dates" colspan="2"/>
	                               <field name="create_date"/>
	                               <field name="date_closed"/>
	                            </group>
	                            <group col="2" colspan="2">
                                   <separator string="Misc" colspan="2"/>
                                   <field name="id"/>
                                   <field name="active"/>
                                </group>
	                            <group col="3" colspan="4">
	                                <separator colspan="4" string="References"/>
	                                <field name="ref" />
	                                <field name="ref2" />
	                            </group>
	                            <!-- TODO-->
	                           <field name="log_ids" nolabel="1" colspan="4">
	                                <tree string="Logs">
	                                    <field name="name" colspan="4"/>
	                                    <field name="date"/>
	                                    <field name="user_id"/>
	                                </tree>
	                                <form string="Logs">
	                                    <separator string="Action Information" colspan="4"/>
	                                    <field name="name" colspan="4"/>
	                                    <field name="date"/>
	                                    <field name="user_id"/>
	                                </form>
	                            </field>
	                        </page>
                    </notebook>
                </form>
            </field>
        </record>

<!-- Search view of event registration form-->

        <record model="ir.ui.view" id="view_registration_search">
            <field name="name">Registrations</field>
            <field name="model">event.registration</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Event Registration">
                    <group col="12" colspan="4">
                        <filter icon="terp-document-new" string="Draft" name="draft" domain="[('state','=','draft')]" help="Draft Registrations"/>
                        <filter icon="terp-camera_test" string="Confirmed" domain="[('state','in',('open','done'))]" help="Confirmed Registrations"/>
                        <separator orientation="vertical"/>
                        <field name="partner_id" />
                        <field name="event_id" widget="selection"/>
                        <field name="state" select="1"/>
                        
                        <field name="user_id" widget="selection">
                              <filter icon="terp-personal"
                                    string="My Registration"
                                    help="My Registration"
                                    domain="[('user_id','=',uid)]"/>
                        </field>
                    </group>
                    <newline/>    
                    <group expand="0" string="Group By...">
                        <filter string="Event" icon="terp-crm" domain="[]" context="{'group_by':'event_id'}"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Partner" icon="terp-personal" domain="[]" context="{'group_by':'partner_id'}"/>                        
                        <filter string="Responsible"  icon="terp-personal" domain="[]" context="{'group_by':'user_id'}"/>
                   </group>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_registration">
          <field name="name">Registrations</field>
          <field name="res_model">event.registration</field>
          <field name="view_type">form</field>
          <field name="domain"></field>
          <field name="view_mode">tree,form</field>
          <field name="context">{"search_default_draft": "1"}</field>
          <field name="search_view_id" ref="view_registration_search"/>
        </record>
        
        <menuitem
            name="Registrations"
            id="menu_action_registration" parent="menu_event_main"
            action="action_registration"/>
        <menuitem name="Reporting" id="menu_report_event" parent="menu_marketing_event_main" sequence="20"/>
    </data>
</openerp>
