<?xml version="1.0"?>
<openerp>
<data>

	<menuitem name="Process Changes" icon="terp-stock" id="menu_process_changes"/>
	
	<menuitem name="Process Changes" id="menu_document_process_changes" parent="menu_process_changes"/>
	<menuitem name="Change Control" id="menu_change_control" parent="menu_process_changes"/>
	<menuitem name="Reporting" id="menu_reporting" parent="menu_process_changes"/>
	<menuitem name="Configuration" id="menu_configuration" parent="menu_process_changes"/>
	
	<!--    
		Structure
	-->
    <record model="ir.ui.view" id="view_document_structure_form">
        <field name="name">document.directory</field>
        <field name="model">document.directory</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
        	<form string="Structure">
	        	<field name="name"/>
	        	<field name="parent_id"/>
        	</form>
        </field>
    </record>
    
    <record model="ir.ui.view" id="view_document_structure_tree">
        <field name="name">document.directory</field>
        <field name="model">document.directory</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
        	<tree string="Structure">
	        	<field name="name"/>
	        	<field name="parent_id"/>
	        </tree>
        </field>
    </record>
    
    <record model="ir.actions.act_window" id="action_document_structure_form">
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">document.directory</field>
        <field name="name">Structure</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_document_structure_tree"/>
    </record>
    <record id="action_document_structure_tree_view" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="act_window_id" ref="action_document_structure_form"/>
    </record>
    <record id="action_document_structure_form_view" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_document_structure_form"/>
        <field name="act_window_id" ref="action_document_structure_form"/>
    </record>
    <menuitem name="Structure" id="menu_document_structure_config" parent="menu_configuration"/>
    <menuitem action="action_document_structure_form" id="menu_structure_form" parent="menu_document_structure_config"/>
	
	<act_window domain="[('structure_id', '=', active_id)]" 
		id="act_structure_process_changes" 
		name="Process Changes" 
		res_model="document.change.process" 
		src_model="document.directory"/>
	
	<!-- 
		Document Types 
	-->
	<record model="ir.ui.view" id="view_document_type_form">
        <field name="name">document.change.type.form</field>
        <field name="model">document.change.type</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Document Types">
                <field name="name" select="1" colspan="4"/>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_document_type_tree">
        <field name="name">document.change.type.tree</field>
        <field name="model">document.change.type</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Document Types">
                <field name="name"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_document_type_form">
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">document.change.type</field>
        <field name="name">Document Types</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    <menuitem name="Documents" id="menu_document_type_config" parent="menu_configuration"/>
    <menuitem action="action_document_type_form" id="menu_document_type_form" parent="menu_document_type_config"/>
	    
    <!-- 
    	Phase Types 
    -->
    <record model="ir.ui.view" id="view_process_phase_type_form">
        <field name="name">document.change.process.phase.type.form</field>
        <field name="model">document.change.process.phase.type</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Phase Types">
            	<group colspan="4" col="6">
	                <field name="name" select="1" string="Phase Type"/>
	                <field name="sequence"/>
	                <field name="active"/>
	            </group>
                <separator string="Associated Document Types" colspan="4"/>
                <field name="document_type_ids" colspan="4" nolabel="1"/>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_process_phase_type_tree">
        <field name="name">document.change.process.phase.type.tree</field>
        <field name="model">document.change.process.phase.type</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Phase Types">
				<field name="sequence"/>
                <field name="name" string="Phase Type"/>
                <field name="document_type_ids"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_process_phase_type_form">
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">document.change.process.phase.type</field>
        <field name="name">Types of Phases</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    
    <menuitem name="Process Changes" id="menu_process_changes_config" parent="menu_configuration"/>
    <menuitem action="action_process_phase_type_form" id="menu_phase_type_form" parent="menu_process_changes_config"/>
    
    <!-- Document Change Process Type -->
       <record model="ir.ui.view" id="view_change_process_type_form">
        <field name="name">document.change.process.type.form</field>
        <field name="model">document.change.process.type</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Phase Types">
	                <field name="name" select="1" string="Phase Type"/>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_change_processe_type_tree">
        <field name="name">document.change.process.type.tree</field>
        <field name="model">document.change.process.type</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Phase Types">
                <field name="name" string="Phase Type"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_change_process_type_form">
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">document.change.process.type</field>
        <field name="name">Type Process</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    
    <menuitem action="action_change_process_type_form" id="menu_change_process_type_form" parent="menu_process_changes_config"/>
    
    <!-- 
    	Model of Changes 
    -->
    <record model="ir.ui.view" id="view_model_change_form">
        <field name="name">document.change.process.model.form</field>
        <field name="model">document.change.process.model</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Model of Changes">
                <field name="name" select="1"/>
                <field name="sequence"/>
                <field name="phase_type_ids" colspan="4"/>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_model_change_form">
        <field name="name">document.change.process.model.tree</field>
        <field name="model">document.change.process.model</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Model of Changes">
                <field name="name"/>
                <field name="sequence"/>
                <field name="phase_type_ids"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_model_change_form">
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">document.change.process.model</field>
        <field name="name">Model of Changes</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    <menuitem action="action_model_change_form" id="menu_model_change_form" parent="menu_process_changes_config"/>
    
	<!-- 
		Documents 
	-->
    <record model="ir.ui.view" id="view_document_form">
        <field name="name">ir.attachment</field>
        <field name="model">ir.attachment</field>
        <field name="priority" eval="1"/>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Documents">
                <group colspan="4" col="4">
                    <field name="name" select="1" string="Document Name"/>
                    <field name="parent_id"/>
                    <field name="datas_fname"/>
                    <field name="datas" filename="datas_fname" string="Content"/>
                </group>
                <separator string="Change Control" colspan="4"/>
                <group col="7" colspan="4">
	                <field name="state"/>
					<button name="button_change_proposed" states="cancel,to_update" string="Request Change" icon="gtk-apply"/>
					<button name="button_change_validated" states="change_request,validate,cancel" string="Propose Change" icon="gtk-apply"/>
					<button name="button_update" states="change_proposed,in_production" string="To Update"  icon="gtk-ok" />
					<button name="button_change_request" states="to_update" string="In Production" icon="gtk-media-play"/>
					<button name="button_cancel" states="change_request,change_proposed" string="Cancel"  icon="gtk-cancel"/>
                </group>
                <newline/>
                <field name="target_document_id"/>
                <field name="target"/>
                <newline/>
                <separator string="Change Note" colspan="4"/>
                <field colspan="4" name="description" nolabel="1"/>
                <group colspan="2" col="2">
                    <separator string="Creation" colspan="2"/>
                    <field name="create_uid" readonly="1"/>
                    <field name="create_date" readonly="1"/>
                </group>
                <group colspan="2" col="2">
                    <separator string="Latest Modification" colspan="2"/>
                    <field name="write_date" readonly="1"/>
                    <field name="write_uid" readonly="1"/>
                </group>
                
        		<field name="email_notification_ids" colspan="4" mode="tree, form" readonly="1" widget="one2many_list" nolabel="1">
        			<tree string="Notifications">
        				<field name="email"/>
        				<field name="create_date"/>
        			</tree>
        			<form string="Notifications">
        				<field name="email"/>
        				<field name="create_date"/>
                        <field name="name" string="Subject" colspan="4"/> 
                        <separator string="Description" colspan="4"/>               			
                        <field colspan="4" name="description" nolabel="1"/>
        			</form>
        		</field>
                
            </form>
        </field>
    </record>
    <record model="ir.ui.view" id="view_document_tree">
        <field name="name">ir.attachment</field>
        <field name="model">ir.attachment</field>
        <field name="type">tree</field>
        <field name="priority" eval="1"/>
        <field name="arch" type="xml">
            <tree string="Documents">
                <field name="name" string="Document Name"/>
                <field name="partner_id"/>
                <field name="datas_fname"/>
                <field name="create_date"/>
                <field name="write_date"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_document_form">
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">ir.attachment</field>
        <field name="name">Documents</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    
    <record id="action_document_tree_view" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_document_tree"/>
        <field name="act_window_id" ref="action_document_form"/>
    </record>
    <record id="action_document_form_view" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_document_form"/>
        <field name="act_window_id" ref="action_document_form"/>
    </record>
    <menuitem action="action_document_form" id="menu_documents_form" parent="menu_document_process_changes"/>
    
    <record model="ir.actions.act_window" id="action_document_without_type_form">
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">ir.attachment</field>
        <field name="name">Documents Without Type</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_document_tree"/>
        <field name="domain">[('type_id','=',',False)]</field>
    </record>
    <menuitem action="action_document_without_type_form" id="menu_documents_without_type_form" parent="menu_change_control"/>
    
    <record model="ir.actions.act_window" id="action_document_to_update_form">
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">ir.attachment</field>
        <field name="name">Documents to Update</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_document_tree"/>
        <field name="domain">[('state','=','change_proposed')]</field>    
        </record>
    <menuitem action="action_document_to_update_form" id="menu_documents_to_update_form" parent="menu_change_control"/>
	
	<!-- 
		Phases 
	-->
	<record model="ir.ui.view" id="view_process_phase_form">
        <field name="name">document.change.process.phase.form</field>
        <field name="model">document.change.process.phase</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Phases">
				<group colspan="4" col="6">            
	                <field name="name" select="1"/>
	                <field name="process_id" string="Process Change"/>
	                <field name="sequence"/>
	                <newline/>
	                <field name="update_document" string="Update documents"/>
	                <field name="type" string="Type"/>
	                <field name="date_control" string="Control date" attrs="{'required':[('type','=','control_required')], 'invisible': [('type','!=','control_required')]}"/>
	                <field name="phase_ids" string="Phase Type"/>
	            </group>
				<separator colspan="4" string="Documents"/>
                <field name="phase_document_ids" colspan="4"  nolabel="1"/>
                <newline/>
                <group col="5" colspan="4">
	                <field name="state"/>
	                <button name="button_start" states="draft" string="Start" icon="gtk-go-forward"/>
	                <button name="button_validate" states="started" string="Validate" icon="gtk-execute"/>
 					<button name="button_pending" states="pending" string="Pending" icon="gtk-execute"/>	
	                <button name="button_done" states="done" string="Done" icon="gtk-jump-to"/>
	                <button name="button_progress" states="validate" string="Done" icon="gtk-jump-to"/>
            	</group>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_process_phase_tree">
        <field name="name">document.change.process.phase.tree</field>
        <field name="model">document.change.process.phase</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Phases">
                <field name="sequence"/>
                <field name="name"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_process_phase_form">
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">document.change.process.phase</field>
        <field name="name">Phases</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
	<menuitem action="action_process_phase_form" id="menu_phases_form" parent="menu_document_process_changes"/>

	<record model="ir.actions.act_window" id="action_process_phase_form_validate">
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">document.change.process.phase</field>
        <field name="name">Phases to Validate</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state','=','draft')]</field>
    </record>	
	<menuitem action="action_process_phase_form_validate" id="menu_phases_to_validate_form" parent="menu_change_control"/>
	
	<act_window domain="[('type_id', '=', active_id)]" 
		id="act_documents_phases" 
		name="Documents" 
		res_model="ir.attachment" 
		src_model="document.change.process.phase"/>
	
	<!--
	Process Change
	-->
	<record model="ir.ui.view" id="view_process_form">
        <field name="name">document.change.process.form</field>
        <field name="model">document.change.process</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Process Change">
            	<group colspan="4" col="6">
	                <field name="name" select="1"/>
	                <field name="process_type_id" widget="selection" select="1"/>
	                <field name="structure_id" select="1"/>
	                <newline/>
	                <field name="description" colspan="4"/>
	                <field name="process_model_id" widget="selection"/>
	            </group>
                <notebook colspan="4">
                	<page string="Process Definition">
                		<group col="2" colspan="2">
                			<separator string="Responsibles" colspan="2"/>
                			<field name="user_id"/>
                		</group>
                		<group col="2" colspan="2">
                			<separator string="Dates" colspan="2"/>
                			<field name="create_date"/>
                			<field name="latest_modified_date"/>
                			<field name="date_expected"/>
                		</group>
                		<newline />
                		 <separator colspan="4" string="Change Description"/>
                		<field name="change_description" colspan="4" nolabel="1"/>
                		<newline/>
                		<group col="6" colspan="4">
                			<field name="state"/>
                			<button name="button_in_progress" states="draft" string="Start" icon="gtk-go-forward"/>
                			<button name="button_validate" states="progress" string="Validate" icon="gtk-execute"/>
                			<button name="button_pending" states="progress,confirmed" string="Pending" icon="gtk-media-pause"/>
                			<button name="button_done" states="confirmed" string="Done" icon="gtk-jump-to"/>
                		</group>
                	</page>
                	<page string="Phases">
                		<field name="process_phase_ids" mode="tree,form" widget="one2many_list" nolabel="1">
                			<tree string="Process Phases" editable="True">
                				<field name="name"/>
                				<field name="type"/>
                				<field name="phase_document_ids"/>
                				<field name="state"/>
                			</tree>
                			<form string="Process Phases">
                				<field name="name"/>
                				<field name="type"/>
                				<field name="phase_document_ids" colspan="4"/>
                				<field name="state"/>
                			</form>
                		</field>
                	</page>
                	<page string="Documents">
                		<field name="process_document_ids" mode="tree,form" colspan="4" nolabel="1">
                			<tree string="Documents">
                				<field name="name" string="Document Name"/>
                				<field name="state"/>
                			</tree>
                			<form string="Documents">
                				<field name="name" string="Document Name"/>
                				<field name="state"/>
                			</form>
                		</field>
                	</page>                	
                </notebook>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_process_tree">
        <field name="name">document.change.process.tree</field>
        <field name="model">document.change.process</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Process Change">
                <field name="name"/>
                <field name="process_type_id"/>
                <field name="structure_id"/>
                <field name="description"/>
                <field name="process_model_id"/>
            </tree>
        </field>
    </record>

  
    <record model="ir.actions.act_window" id="action_process_form">
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">document.change.process</field>
        <field name="name">Process Changes</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    <menuitem action="action_process_form" id="menu_process_changes_form" parent="menu_document_process_changes"/>
    
    <record model="ir.actions.act_window" id="action_process_change_form_validate">
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">document.change.process</field>
        <field name="name">Process Changes to Validate</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('state','=','draft')]</field>
    </record>	
	<menuitem action="action_process_change_form_validate" id="menu_process_to_validate_form" parent="menu_change_control"/>
	
	<act_window domain="[('phase_ids', '=', active_id)]" 
		id="act_phase_change_process" 
		name="Phases" 
		res_model="document.change.process.phase" 
		src_model="document.change.process"/>
	
	<act_window domain="[('type_id', '=', active_id)]" 
		id="act_documents_change_process" 
		name="Documents" 
		res_model="ir.attachment" 
		src_model="document.change.process"/>
	
</data>
</openerp>
