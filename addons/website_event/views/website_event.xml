<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>

    <!-- Layout add nav and footer -->

    <record id="header_website_event" model="ir.ui.view">
        <field name="name">header_website_event</field>
        <field name="inherit_id" ref="website.header"/>
        <field name="arch" type="xml">
            <data>
                <xpath expr="//ul[@id='top_menu']/li" position="after">
                    <li><a href="/event">Events</a></li>
                </xpath>
           </data>
        </field>
    </record>
    <record id="footer_website_event" model="ir.ui.view">
        <field name="name">footer_website_event</field>
        <field name="inherit_id" ref="website.footer"/>
        <field name="arch" type="xml">
            <data>
                <xpath expr="//a[@href='/page/website.contactus']" position="after">
                    <li><a href="/event">Events</a></li>
                </xpath>
           </data>
        </field>
    </record>

    <!-- Page --> 
 
    <template id="index">
        <t t-call="website.layout">
            <t t-set="head">
                <script type="text/javascript" src="/website_event/static/src/js/website_event.js"></script>
                <t t-raw="head or ''"/>
            </t>
            <t t-set="title">Events</t>
            <div class="container mt48">
                <div class="row">
                    <div class="span4 css_noprint">
                        <ul class="nav nav-list">
                            <li class="nav-header">Date</li>
                            <t t-foreach="dates" t-as="date">
                                <li t-att-class="searches.get('date') == date[0] and 'active' or ''">
                                    <a  t-att-href="'/event/%%s&amp;date=%%s' %% (search_path, date[0])"><t t-esc="date[1]"/> <small t-if="date[3]">(<t t-esc="date[3]"/>)</small></a>
                                </li>
                            </t>
                        </ul>
                        <ul class="nav nav-list">
                            <li class="nav-header">Category</li>
                            <t t-foreach="types">
                                <li t-if="type" t-att-class="searches.get('type') == str(type and type[0]) and 'active' or ''">
                                    <a t-att-href="'/event/%%s&amp;type=%%s' %% (search_path, type[0])"><t t-esc="type[1]"/> <small>(<t t-esc="type_count"/>)</small></a>
                                </li>
                            </t>
                        </ul>
                        <ul class="nav nav-list">
                            <li class="nav-header">Location</li>
                            <t t-foreach="countries">
                                <li t-if="country_id" t-att-class="searches.get('country') == str(country_id and country_id[0]) and 'active' or ''">
                                    <a t-att-href="'/event/%%s&amp;country=%%s' %% (search_path, country_id[0])"><t t-esc="country_id[1]"/><small>(<t t-esc="country_id_count"/>)</small></a>
                                </li>
                            </t>
                        </ul>
                    </div>
                    <div class="span8">
                        <ul class="media-list mt32">
                            <li t-foreach="event_ids" t-as="event_id" class="media thumbnail">
                                <div class="media-body">
                                    <span t-if="not event_id.event_ticket_ids" class="label pull-right">No tickets needed.</span>
                                    <t t-if="event_id.event_ticket_ids">
                                        <span t-if="event_id.register_avail == 9999" class="label pull-right label-info">Tickets availables.</span>
                                        <span t-if="not event_id.register_avail" class="label pull-right">No ticket available.</span>
                                        <span t-if="event_id.register_avail and event_id.register_avail != 9999" t-att-class="'label pull-right label-%%s' %% (event_id.register_avail &lt;= 10 and 'warning' or 'info')">
                                            <t t-if="event_id.register_avail &lt;= 10">Only</t>
                                            <t t-esc="event_id.register_avail"/>
                                            <t t-if="event_id.register_avail &gt; 1">tickets </t>
                                            <t t-if="event_id.register_avail == 1">ticket </t>
                                            available.
                                        </span>
                                    </t>
                                    <h4 class="media-heading"><a t-att-href="'/event/%%s/' %% event_id.id"><span t-field="event_id.name"> </span></a></h4>
                                    <a t-if="editable" href="#" t-att-data-id="event_id.id" class="pull-right">
                                        <span t-att-class="'label label-success js_unpublish %%s' %% (not event_id.website_published and 'hidden' or '')">Click to Unpublish</span>
                                        <span t-att-class="'label label-important js_publish %%s' %% (event_id.website_published and 'hidden' or '')">Click to Publish</span>
                                    </a>
                                    <div>
                                        <span t-field="event_id.type">: </span>
                                        <t t-if="event_id.user_id">
                                            Organized by: <span t-field="event_id.user_id"> </span>
                                        </t>
                                    </div>
                                    <div>
                                        <i class="icon-time"></i> <span t-field="event_id.date_begin"> </span> <i>to</i> <span t-field="event_id.date_end"> </span>
                                    </div>
                                    <div t-if="event_id.country_id">
                                        <i class="icon-map-marker"></i> <span t-field="event_id.city"> </span>  <span t-field="event_id.zip"> </span>, <span t-field="event_id.country_id"> </span>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="detail">
        <t t-call="website.layout">
            <t t-set="head">
                <script type="text/javascript" src="/website_event/static/src/js/website_event.js"></script>
                <t t-raw="head"/>
            </t>
            <t t-set="title">Events</t>
            <div class="container mt48">
                <div class="row">
                    <div class="span4 css_noprint">
                        <h4>When &amp; Where</h4>
                        <img t-att-src="google_map_url"/>
                        <address>
                            <pre t-field="event_id.address_id"/>
                            <i class="icon-time"></i> <span t-field="event_id.date_begin"> </span><br/>
                            <i class="icon-time"></i> <span t-field="event_id.date_end"> </span>
                            <t t-if="event_id.user_id">
                                <h6>Organized by:</h6>
                                <pre><t t-field="event_id.organizer_id"/><br/><span>&amp;#x2706;</span> <span t-field="event_id.phone"></span><br/><i class="icon-envelope"></i> <span t-field="event_id.email"></span></pre>
                            </t>
                        </address>
                    </div>
                    <div class="span8">
                        <div class="media-body">
                            <span t-if="not event_id.event_ticket_ids" class="label pull-right">No tickets needed.</span>
                            <t t-if="event_id.event_ticket_ids">
                                <span t-if="event_id.register_avail == 9999" class="label pull-right">Tickets availables.</span>
                                <span t-if="not event_id.register_avail" class="label pull-right">No ticket available.</span>
                                <span t-if="event_id.register_avail and event_id.register_avail != 9999" t-att-class="'label pull-right label-%%s' %% (event_id.register_avail &lt;= 10 and 'warning' or 'info')">
                                    <t t-if="event_id.register_avail &lt;= 10">Only</t>
                                    <t t-esc="event_id.register_avail"/>
                                    <t t-if="event_id.register_avail &gt; 1">tickets </t>
                                    <t t-if="event_id.register_avail == 1">ticket </t>
                                    available.
                                </span>
                            </t>
                            <h4 class="media-heading"><a t-att-href="'/event/%%s/' %% event_id.id"><span t-field="event_id.name"> </span></a></h4>
                            <a t-if="editable" href="#" t-att-data-id="event_id.id" class="pull-right">
                                <span t-att-class="'label label-success js_unpublish %%s' %% (not event_id.website_published and 'hidden' or '')">Click to Unpublish</span>
                                <span t-att-class="'label label-important js_publish %%s' %% (event_id.website_published and 'hidden' or '')">Click to Publish</span>
                            </a>
                            <h5 class="media-heading">
                                <span t-field="event_id.address_id"/><br/>
                                <i class="icon-time"></i> <span t-field="event_id.date_begin"/><br/>
                                <i class="icon-time"></i> <span t-field="event_id.date_end"/>
                            </h5>
                            <h4 t-if="event_id.event_ticket_ids">Ticket Information</h4>
                            <form t-att-action="'/event/%%s/add_cart' %% event_id.id" method="post" t-if="event_id.event_ticket_ids">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Ticket type</th>
                                            <th>Sales End</th>
                                            <th>Price</th>
                                            <th>Seats</th>
                                            <th>Quantity</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr t-foreach="event_id.event_ticket_ids" t-as="ticket">
                                            <td t-field="ticket.product_id"/>
                                            <td t-field="ticket.deadline"/>
                                            <td t-field="ticket.price"/>
                                            <td><span t-if="ticket.register_max"><t t-esc="ticket.register_current"/>/<t t-field="ticket.register_max"/></span></td>
                                            <td>
                                                <select t-if="ticket.register_avail" t-att-name="'ticket-%%s' %% ticket.id">
                                                    <t t-foreach="range(0, ticket.register_avail > 9 and 10 or ticket.register_avail+1 )" t-as="nb"><option t-esc="nb"/></t>
                                                </select>
                                                <span t-if="not ticket.register_avail">Not ticket available</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <button type="submit" class="btn btn-primary" t-if="event_id.register_avail">Order Now</button>
                            </form>
                            <h4>Event Details</h4>
                            <div t-field="event_id.description_website"></div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
 </data>
</openerp>
