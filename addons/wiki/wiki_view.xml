<?xml version="1.0"?>
<openerp>
    <data>
       <menuitem name="Knowledge Management" icon="terp-stock" id="base.menu_document" sequence="4"/>
        <menuitem name="Configuration" id="base.menu_document_configuration" parent="base.menu_document" sequence="50"/>
        <menuitem name="Wiki" id="menu_wiki_configuration" parent="base.menu_document_configuration" sequence="2"/>
        <menuitem id="base.menu_document2" name="Collaborative Content" parent="base.menu_document"/>

         <wizard
            id="wizard_group_menu_create"
            string="Create Menu"
            menu="True"
            name="wiki.create.menu"/>

        <wizard
            id="wizard_open_page"
            string="Open Page"
            menu="True"
            name="wiki.wiki.page.open"/>

        <record model="ir.ui.view" id="wiki_group_tree">
            <field name="name">wiki.groups.tree</field>
            <field name="model">wiki.groups</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Wikis">
                    <field name="name"/>
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="wiki_group_form">
            <field name="name">wiki.groups.form</field>
            <field name="model">wiki.groups</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Wikis">
                    <group colspan="4" col="4">
                        <field name="name" select="1"/>
                        <field name="create_date" readonly="2"/>
                        <field name="method" select="1"/>
                        <field name="home" select="1"  attrs="{'required':[('method','=','page')], 'readonly':[('method','!=','page')]}"/>
                        <!--field name="section"/-->
                    </group>
                    <notebook colspan="4">
                    <page string="Notes">
                        <field name="notes" colspan="4" nolabel="1"/>
                    </page><page string="Configuration">
                        <separator string="Page Template" colspan="4"/>
                        <field name="template" colspan="4" nolabel="1" widget="text_wiki"/>
                    </page>
                    </notebook>
                     <button
			 	    	name="%(wiki.action_wiki_create_menu)d"
			 	    	string="Create Menu"
			 	     	type="action"
			 	     	icon="gtk-justify-fill" />
			 	     <button
			 	    	name="%(wiki.action_view_wiki_wiki_page_open)d"
			 	    	string="Open Wiki Page"
			 	     	type="action"/>

                </form>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_wiki_groups">
            <field name="name">Wikis</field>
            <field name="res_model">wiki.groups</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>
     <!--   <menuitem
            parent="menu_document_configuration"
            id="menu_action_wiki_groups"
            action="action_wiki_groups"/>-->
      <menuitem name="Wiki Groups"
            parent="menu_wiki_configuration"
            id="menu_action_wiki_groups"
            action="action_wiki_groups"/>

        <record model="ir.actions.act_window" id="action_wiki_groups_browse">
            <field name="name">Wikis</field>
            <field name="res_model">wiki.groups</field>
            <field name="view_type">tree</field>
        </record>
       <!-- <menuitem
            parent="menu_document"
            id="menu_action_wiki_groups_browse"
            action="action_wiki_groups_browse"/>-->

        <record id="view_wiki_tree_childs" model="ir.ui.view">
            <field name="name">wiki.wiki.tree.childs</field>
            <field name="model">wiki.wiki</field>
            <field name="type">tree</field>
            <field name="field_parent">child_ids</field>
            <field name="priority">100</field>
            <field name="arch" type="xml">
                <tree string="Wiki">
                    <field name="name"/>
                    <field name="section" invisible="not context.get('section',False)"/>
                    <field name="review"/>
                    <field name="write_uid"/>
                    <field name="write_date"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="view_wiki_tree">
            <field name="name">wiki.wiki.tree</field>
            <field name="model">wiki.wiki</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Wiki">
                    <field name="name"/>
                    <field name="section" invisible="not context.get('section',False)"/>
                    <field name="group_id" invisible="context.get('group_id',False)"/>
                    <field name="review"/>
                    <field name="write_uid"/>
                    <field name="write_date"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="view_wiki_form">
            <field name="name">wiki.wiki.form</field>
            <field name="model">wiki.wiki</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Wiki">
                    <group col="6" colspan="4">
                        <field name="name" select="1" colspan="6"/>
                        <field name="group_id" select="1" on_change="onchange_group_id(group_id, text_area)"/>
                        <field name="section" select="2" invisible="not context.get('section',False)"/>
                        <field name="parent_id"/>
                    </group>
                    <field name="text_area" nolabel="1" colspan="4" select="1" widget="text_wiki"/>
                    <separator colspan="4" string="Modifications"/>
                    <group col="6" colspan="4">
                        <field name="write_date" readonly="1" select="2"/>
                        <field name="review" select="1"/>
                        <field name="toc"/>
                        <field name="tags" select="1" groups="base.group_extended"/>
                        <field name="summary" colspan="4" select="2" groups="base.group_extended"/>
                    </group>
                     <button
			 	    	name="%(wiki.action_view_wiki_wiki_help_open)d"
			 	    	string="Basic Wiki Editing"
			 	     	type="action"/>
			 	     <button
			 	    	name="%(wiki.action_view_wiki_make_index)d"
			 	    	string="Create Index"
			 	     	type="action"/>
                </form>
            </field>
        </record>

		<record id="view_wiki_filter" model="ir.ui.view">
            <field name="name">wiki.wiki.search</field>
            <field name="model">wiki.wiki</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Wiki">
                    <group col='8' colspan='4'>
                        <filter icon="gtk-execute" string="My" domain="[('create_uid','=',uid)]" help="My Pages"/>
                        <separator orientation="vertical"/>
                        <field name="name" select="1"/>
                        <field name="group_id" select="1"/>
                        <field name="text_area" select="1"/>
                        <field name="review" select="1"/>
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_wiki">
            <field name="name">Search Pages</field>
            <field name="res_model">wiki.wiki</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_wiki_tree"/>
            <field name="context">{'section':'1'}</field>
            <field name="search_view_id" ref="view_wiki_filter"/>
        </record>
        <menuitem parent="base.menu_document2" id="menu_action_wiki_wiki" name="Wiki Pages" action="action_wiki"/>

        <!--  Pages Waiting Review -->
        <record model="ir.actions.act_window" id="action_wiki_review">
            <field name="name">Pages Waiting Review</field>
            <field name="res_model">wiki.wiki</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_wiki_tree"/>
            <field name="context">{'section':'1'}</field>
            <field name="domain">[('review','=',True)]</field>
            <field name="filter" eval="True"/>
        </record>

        <record model="ir.ui.view" id="view_wiki_history_tree">
            <field name="name">wiki.wiki.history.tree</field>
            <field name="model">wiki.wiki.history</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Wiki History">
                    <field name="create_date"/>
                    <field name="write_uid"/>
                    <field name="minor_edit" groups="base.group_extended"/>
                    <field name="summary"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="wiki_history_form">
            <field name="name">wiki.wiki.history.form</field>
            <field name="model">wiki.wiki.history</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Wiki History">
                    <field name="wiki_id" select="1" colspan="4"/>
                    <field name="summary" select="1" colspan="4"/>
                    <field name="text_area" select="1" colspan="4" nolabel="1" widget="text_wiki"/>
                    <field name="create_date" select="1"/>
                    <field name="minor_edit" select="1" groups="base.group_extended"/>
                </form>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_history">
            <field name="name">All Page Histories</field>
            <field name="res_model">wiki.wiki.history</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>
       <!-- <menuitem
            parent="menu_document_configuration"
            id="menu_action_history"
            action="action_history"/>-->

        <act_window domain="[('wiki_id', '=', active_id)]"
            id="act_wiki_wiki_history"
            name="Page History"
            res_model="wiki.wiki.history"
            src_model="wiki.wiki"/>

        <act_window domain="[('group_id', '=', active_id)]"
            id="act_wiki_group_open"
            name="Search Page"
            res_model="wiki.wiki"
            src_model="wiki.groups"/>

         <wizard
            id="wizard_open_page"
            string="Open Wiki Pages"
            name="wiki.wiki.page.open"
            model="wiki.groups"/>

        <record id="ir_open_wiki_pages" model="ir.values">
            <field name="key2">tree_but_open</field>
            <field name="model">wiki.groups</field>
            <field name="name">Search a Page</field>
            <field eval="'ir.actions.wizard,%d'%wizard_open_page" name="value"/>
            <field eval="True" name="object"/>
        </record>

        <!--record id="ir_open_account_account" model="ir.values">
            <field eval="'tree_but_open'" name="key2"/>
            <field eval="'wiki.groups'" name="model"/>
            <field name="name">Search a Page</field>
           <field eval="'ir.actions.act_window,%d'%act_wiki_group_open" name="value"/>
            <field eval="True" name="object">
        </record-->

    </data>
</openerp>
