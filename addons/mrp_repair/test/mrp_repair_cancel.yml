-
  In order to test "mrp_repair" module.
-
  I have create stock move line record.
-
  !record {model: stock.move, id: stock_move_pcbasicpc0}:
    company_id: base.main_company
    date: !eval datetime.today().strftime("%Y-%m-%d %H:%M:%S")
    date_expected: !eval datetime.today().strftime("%Y-%m-%d %H:%M:%S")
    location_dest_id: stock.stock_location_stock
    location_id: stock.stock_location_stock
    name: '[PC1] Basic PC'
    product_id: product.product_product_pc1
    product_qty: 1.0
    product_uom: product.product_uom_unit
    product_uos_qty: 1.0

-
  I start by creating new Repair order for "Basic Pc" product and Invoice Type b4repair.
-
  !record {model: mrp.repair, id: mrp_repair_rma2}:
    address_id: base.res_partner_address_1
    guarantee_limit: !eval datetime.today().strftime("%Y-%m-%d")
    invoice_method: 'b4repair'
    partner_invoice_id: base.res_partner_address_1
    location_dest_id: stock.stock_location_14
    location_id: stock.stock_location_14
    move_id: 'stock_move_pcbasicpc0'
    name: RMA000055
    invoiced: 1
    operations:
      - location_dest_id: stock.location_production
        location_id: stock.stock_location_stock
        name: '[HDD1] HDD Seagate 7200.8 80GB'
        price_unit: 50.0
        product_id: product.product_product_hdd1
        product_uom: product.product_uom_unit
        product_uom_qty: 1.0
        state: draft
        to_invoice: 1
        type: add
    fees_lines:
      - name: 'HDD1 Seagate repair fees'
        product_id: product.product_product_hdd1
        product_uom_qty: 1.0
        product_uom: product.product_uom_unit
        price_unit: 50.0
    partner_id: base.res_partner_9
    product_id: product.product_product_pc1
-
  I confirm This Repair order.
-
  !workflow {model: mrp.repair, action: repair_confirm, ref: mrp_repair_rma2}
-
  Cancel Repair order.
-
  !python {model: mrp.repair.cancel}: |
    context = {"lang": 'en_US', "active_model":"mrp.repair", "active_ids": [ref("mrp_repair_rma2")], "tz": False, "active_id":ref('mrp_repair_rma2')}
    self.fields_view_get(cr, uid, False, "form", context)
    self.cancel_repair(cr, uid, [ref("mrp_repair_rma2")], context=context)
-
  Reopen the repair order in draft state.
-
  !python {model: mrp.repair}: |
    self.action_cancel_draft(cr, uid, [ref('mrp_repair_rma2')])
-
  Repair order state to 'Ready'.
-
  !python {model: mrp.repair}: |
    self.action_repair_ready(cr, uid, [ref('mrp_repair_rma2')], context=None)
-
 Cancel repair order.
-
  !python {model: mrp.repair}: |
   self.action_cancel(cr, uid, [ref('mrp_repair_rma2')], context=None)
-
  Reopen the repair order in draft state.
-
  !python {model: mrp.repair}: |
    self.action_cancel_draft(cr, uid, [ref('mrp_repair_rma2')])
-
  I confirm This Repair order For Invoice Type b4repair.
-
  !workflow {model: mrp.repair, action: repair_confirm, ref: mrp_repair_rma2}
-
  I click on "Create Invoice" button of this wizard to make invoice.
-
  !python {model: mrp.repair}: |
    import netsvc
    wf_service = netsvc.LocalService("workflow")
    wf_service.trg_validate(uid, 'mrp.repair', ref("mrp_repair.mrp_repair_rma2"), 'action_invoice_create', cr)
-
  I check that Invoice is created for this repair order.
-
  !python {model: account.invoice}: |
     mrp_obj = self.pool.get('mrp.repair')
     repair_id = mrp_obj.browse(cr, uid, [ref('mrp_repair_rma2')], context=context)[0]
     assert repair_id.invoice_id.id, _("No invoice existing for this partner")
-
  I start the repairing  process by click on "Start Repair" Button For Invoice Type b4repair.
-
  !workflow {model: mrp.repair, action: action_repair_start, ref: mrp_repair_rma2}
-
  Repairing Process for product is Done and I End Repair process by click on "End Repair" button For Invoice Type b4repair.
-
  !workflow {model: mrp.repair, action: action_repair_end, ref: mrp_repair_rma2}

