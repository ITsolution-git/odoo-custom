<?xml version="1.0"?>
<openerp>
<data>

    <record model="accounting.assert.test" id="account_test_demo_01">
        <field name="sequence">11</field>
        <field name="name">Test 11: Consistency check between Account Move and Account Move Line</field>
        <field name="desc">Checks id of 'account_move' = move_id of 'account_move_line', and state of 'account_move_line' is valid, and having sum(debit-credit) != 0</field>
        <field name="domain_exec"></field>
        <field name="code_exec"><![CDATA[sql="""SELECT
    sum(debit) as sum_debit,
    sum(credit) as sum_credit,
    sum(debit-credit) as balance,
    am.id as move_id,
    am.state,
    am.period_id
  FROM account_move am, account_move_line ml
  WHERE
       ml.move_id = am.id
     AND
       ml.state = 'valid'
  GROUP BY am.name, am.id, am.state, am.period_id
  HAVING abs(sum(ml.debit-ml.credit)) <> 0"""
cr.execute(sql)
result = cr.dictfetchall()
]]></field>
    </record>

</data>
</openerp>
