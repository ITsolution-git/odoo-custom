-
 I create reception for order where invoice control is 'Based on receptions'.
-
  !python {model: purchase.order}: |
    self.action_picking_create(cr, uid, [ref("order_purchase2")])
-
 I create reception for order where invoice control is 'Based on receptions'.
-
  !python {model: purchase.order}: |
    self.action_invoice_create(cr, uid, [ref("order_purchase2")])
-
  Reception is ready for process so now done the process.
-
  !python {model: purchase.order}: |
    pick_ids = [x.id for x in self.browse(cr, uid, ref("order_purchase2")).picking_ids]
    self.pool.get('stock.picking').validate_picking(cr, uid, pick_ids)
-
  I create an invoice for order by clicking on "Create Invoice" wizard
-
  !python {model: purchase.order}: |
    
    stock = self.pool.get('stock.picking')
    pick_ids = [x.id for x in self.browse(cr, uid, ref("order_purchase2")).picking_ids]
    stock.action_invoice_create(cr, uid,pick_ids, ref('account.expenses_journal'))
-
  Now,put all Purchase Order invoice in open state.
-
  !python {model: purchase.order}: |
    import netsvc
    purchase = self.pool.get('purchase.order')
    invoice_ids = [x.id for x in purchase.browse(cr, uid, ref("order_purchase2")).invoice_ids]
    wf_service = netsvc.LocalService("workflow")
    for invoice in invoice_ids:
      wf_service.trg_validate(uid, 'account.invoice', invoice, 'invoice_open', cr)
-
  I check that purchase order is invoiced & paid or it's shipped.
-
  !python {model: purchase.order}: |
     assert self.browse(cr, uid, ref("order_purchase2")).shipped == True,"Reception is not delivered"
