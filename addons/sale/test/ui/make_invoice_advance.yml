-
  In order to test the 'Make Invoices' wizard of sale module in the Open-ERP,
  I take a Sale order and create invoice.
-
  I confirm the Sale Order.
-
  !workflow {model: sale.order, action: order_confirm, ref: order3}
-
  I confirm another Sale Order.
-
  !workflow {model: sale.order, action: order_confirm, ref: order5}
-
  Then I click on the "Make Invoices" button
-
  !record {model: sale.make.invoice, id: sale_make_invoice_1}:
    grouped: 1
    invoice_date: !eval time.strftime('%Y-%m-%d')
-
  Then I click on the "Create Invoices" button of wizard
-
  !python {model: sale.make.invoice}: |
    context = {"lang": 'en_US', "search_default_user_id":1, "tz": False, "active_model": 'sale.order', "active_ids": [ref("order3"),ref("order5")], "active_id":ref("order3")}
    self.make_invoices(cr, uid, [ref("sale_make_invoice_1")], context)
-
  I verify that an invoice has been created
-
  !python {model: sale.order}: |
    inv = self.browse(cr, uid, ref('order3')).invoice_ids
    inv1 = self.browse(cr, uid, ref('order5')).invoice_ids
    assert inv, "Invoices has not been generated"
    assert inv1, "Invoices has not been generated"
-
  I verify that an account invoice line with origin 'SO003' is created
-
  !python {model: sale.order}: |
    acc_inv_line = self.pool.get('account.invoice.line')
    inv = self.browse(cr, uid, ref('order3')).invoice_ids
    inv1 = self.browse(cr, uid, ref('order5')).invoice_ids
    for line in inv:
      assert line.invoice_line, "Account invoice line has not been created for order3"
    for line in inv1:
      assert line.invoice_line, "Account invoice line has not been created for order5"
