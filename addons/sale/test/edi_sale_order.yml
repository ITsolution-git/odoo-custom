-
  I create a partner which is a my customer
-
  !record {model: res.partner, id: res_partner_test22}:
    name: Junjun wala
    supplier: False
    customer: True
    opt_out: True
-
  I create one Sale Order
-
  !record {model: sale.order, id: sale_order_test}:
    partner_id: res_partner_test22
    partner_invoice_id: base.res_partner_address_3
    partner_order_id: base.res_partner_address_3
    partner_shipping_id: base.res_partner_address_3
    pricelist_id: 1
    order_line:
      - product_id: product.product_product_pc1
        product_uom_qty: 1.0
        product_uom: 1
        price_unit: 150.0
        name: 'basic pc'
-
  I Open the sale order
-
  !python {model: sale.order}: |
    
    orders = self.browse(cr, uid, ref("sale_order_test"))
    import netsvc
    wf_service = netsvc.LocalService("workflow")
    wf_service.trg_validate(uid, 'sale.order',orders.id,'order_confirm', cr)

-
  I Tesing of EDI functionality. First I export Sale Order from my company than import that Order into customer company
-
  !python {model: ir.edi.document}: |
    sale_order_pool = self.pool.get('sale.order')
    orders = sale_order_pool.browse(cr, uid, ref("sale_order_test"))

    tokens = self.export_edi(cr, uid, [orders])
    assert tokens, 'Token is not generated'

-
 I import Sale order from EDI Document of purchase order
-
  !python {model: ir.edi.document}: |
    sale_order_pool = self.pool.get('sale.order')
    edi_document = {
        "order_line": [{
                "name": "basic pc", 
                "product_uom": ["5af1272e-dd26-11e0-b65e-701a04e25543:product.product_uom_unit", "PCE"], 
                "date_planned": "2011-08-31", 
                "price_unit": 150.0, 
                "__last_update": False, 
                "__id": "5af1272e-dd26-11e0-b65e-701a04e25543:purchase.purchase_order_line-AlhsVDZGoKvJ", 
                "product_qty": 1.0, 
                "product_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:product.product_product_pc1", "[PC1] Basic PC"]
        }], 
        "partner_address_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:base.res_partner_address_11", "Sebastien LANGE, France, Alencon, 1 place de l'\u00c9glise"],
        "__id": "5af1272e-dd26-11e0-b65e-701a04e25543:purchase.purchase_order_test", 
        "date_order": "2011-09-12", 
        "partner_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:purchase.res_partner_test20", "jones white"], 
        "__attachments": [], 
        "__module": "purchase", 
        "amount_total": 150.0, 
        "company_address": {
                "phone": "(+32).81.81.37.00", 
                "street": "Chaussee de Namur 40", 
                "city": "Gerompont", 
                "zip": "1367", 
                "__last_update": False, 
                "country_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:base.be", "Belgium"], 
                "__id": "5af1272e-dd26-11e0-b65e-701a04e25543:base.main_address", 
        }, 
        "amount_untaxed": 150.0, 
        "name": "PO00011", 
        "__model": "purchase.order", 
        "__last_update": False, 
        "company_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:base.main_company", "OpenERP S.A."], 
        "__version": [6, 1], 
        "pricelist_id": ["5af1272e-dd26-11e0-b65e-701a04e25543:product.list0", "Public Pricelist (EUR)"]
    }
    new_sale_order_id = sale_order_pool.edi_import(cr, uid, edi_document, context=context)
    assert new_sale_order_id,  'Sale order is not imported'

-
  I Checking the out invoice become in invoice or not after import  ========
-
  !python {model: account.invoice}: |
    
    new_partner_id = self.pool.get('res.partner').name_search(cr, uid, "Thomson pvt. ltd.")
    assert new_partner_id, 'Partner is not created of Supplier'
    ids = self.search(cr, uid, [('partner_id','=',new_partner_id[0][0]),('reference','=',"SAJ/2011/002")])
    assert ids, 'Invoice does not have created of party'
    invoice_new = self.browse(cr, uid, ids[0])
    assert invoice_new.reference == "SAJ/2011/002", "internal number is not stored in reference"
    assert invoice_new.reference_type == 'none', "reference type is not set to 'None'"
    assert invoice_new.internal_number == False, "internal number is not reset"
    assert invoice_new.journal_id.id, "journal id is not selected"
    assert invoice_new.type == 'in_invoice', 'Imported in voice is not supplier invoice'
    product = ['Medium PC','Basic PC']
    for inv_line in invoice_new.invoice_line:
        assert inv_line.account_id.id, "account_id is not taken from product's default"
        assert inv_line.product_id.name in product, "product  is not in Invoice line"
        #print '-----------------=================',inv_line.product_id.quantity
        assert inv_line.product_id.price_subtotal == 375, 'subtotal is not matched'
        #assert inv_line.producr_id.quantity
    for inv_tax in invoice_new.tax_line:
        assert inv_tax.manual, "for tax line manual is not set to True"
        assert inv_tax.account_id, "for tax_line default accounts is not picked based on the tax config of the DB where it is imported."
