<?xml version="1.0" encoding="UTF-8"?>
<template>

    <!-- this template contains the mail widget and is used to namespace the css -->
    <t t-name="mail.Widget">
        <div class="oe_mail">
        </div>
    </t>

    <!--
        mail.compose_message template
        This template holds the composition form to write a note or send
        an e-mail. It contains by default a textarea, that will be replaced
        by another composition form in the main wall composition form, or
        for main thread composition form in document form view.
        -->
    <t t-name="mail.compose_message">
        <div class="oe_msg oe_msg_composer">
            <div class="oe_msg_left">
                <img class="oe_msg_icon" alt="User img" t-attf-src="#{widget.avatar}"/>
            </div>
            <div class="oe_msg_center">
                <div class="oe_msg_content">
                    <textarea class="field_text" placeholder="Add your comment here..."/>
                </div><div class="oe_msg_footer">
                    <div class="oe_msg_attachment_list"/>
                    <button class="oe_post">Post</button>
                    <t t-call="mail.compose_message.add_attachment"/>
                    <t t-call="mail.thread.list_recipients"/>
                    <!--<a class="oe_cancel oe_e">X</a>-->
                    <button class="oe_full oe_right">Full</button>
                </div>
            </div>
        </div>
    </t>

    <!--
        mail.compose_message.compact template
        This template holds the composition form to write a message, this box is converted into
        mail.compose_message when focus on textarea
        -->
    <t t-name="mail.compose_message.compact">
        <div class="oe_msg oe_msg_composer_compact">
            <textarea class="field_text oe_compact" placeholder="Add your comment here..."/>
        </div>
    </t>

    <!--
        mail.compose_message.add_attachment template
        Small template to be inserted in the composition for add attachments
        -->
    <t t-name="mail.compose_message.add_attachment">
        <div class="oe_attachment_file">
            <div class="oe_add">
                <!-- uploader of file -->
                <button><span class="oe_e">p</span></button>
                <t t-call="HiddenInputFile">
                    <t t-set="fileupload_id" t-value="widget.fileupload_id"/>
                    <t t-set="fileupload_action">/web/binary/upload_attachment</t>
                    <input type="hidden" name="model" value="mail.message"/>
                    <input type="hidden" name="id" value="0"/>
                    <input type="hidden" name="session_id" t-att-value="widget.session.session_id"/>
                </t>
            </div>
        </div>
    </t>

    <!--
        mail.thread.message.attachments template
        Template used to display attachments in a mail.message
        -->
    <t t-name="mail.thread.message.attachments">
        <ul t-attf-class="oe_msg_attachments #{widget.attachment_ids[0]?'':'oe_hidden'}">
            <t t-foreach="widget.attachment_ids" t-as="attachment">
                <li>
                    <span t-if="(attachment.upload or attachment.percent_loaded&lt;100)" t-attf-title="{(attachment.name || attachment.filename) + (attachment.date?' \n('+attachment.date+')':'' )}" t-attf-name="{attachment.name || attachment.filename}">
                        <div class="oe_upload_in_process">
                            <span>...Upload in progress...</span>
                        </div>
                        <t t-raw="attachment.name || attachment.filename"/>
                    </span>
                    <a t-if="(!attachment.upload or attachment.percent_loaded&gt;=100)" t-att-href="attachment.url" t-attf-title="{(attachment.name || attachment.filename) + (attachment.date?' \n('+attachment.date+')':'' )}">
                        <t t-raw="attachment.name || attachment.filename"/>
                    </a>
                    <t t-if="(widget.show_delete_attachment and (!attachment.upload or attachment.percent_loaded&gt;=100))">
                        <a class="oe_right oe_mail_attachment_delete" title="Delete this attachment" t-attf-data-id="{attachment.id}">x</a>
                    </t>
                </li>
            </t>
        </ul>
    </t>

    <t t-name="mail.thread.message.private">
        <div>
            <span class="oe_placeholder_checkbox_private"/>
            <span class="oe_send_private">This email is private.</span>
            <span class="oe_send_public">I wrote for contacts and all my followers.</span>
        </div>
    </t>

    <!--
        template to the recipients list
        -->
    <t t-name="mail.thread.list_recipients">
        <div class="oe_mail_list_recipients">
            Post to:
            <span t-if="!widget.is_private" class="oe_all_follower">All Followers</span> 
            <t t-if="!widget.is_private and widget.partner_ids.length"> and </t>
            <t t-set="inc" t-value="0"/>
            <t t-if="widget.partner_ids.length" t-foreach="widget.partner_ids" t-as="partner"><span t-attf-class="oe_partner_follower #{inc>=3?'oe_hidden':''}"><t t-if="inc" t-raw="', '"/><a t-attf-href="#model=res.partner&amp;id=#{partner[0]}"><t t-raw="partner[1]"/></a></span><t t-set="inc" t-value="inc+1"/>
            </t>
            <t t-if="widget.partner_ids.length>=3">
                <span class="oe_more">, <a><t t-raw="widget.partner_ids.length-3"/> others...</a></span>
                <a class="oe_more_hidden">&lt;&lt;&lt;</a>
            </t>
        </div>
    </t>

    <!-- 
        wall main template
        Template used to display the communication history in the wall.
        -->
    <div t-name="mail.wall" class="oe_view_manager oe_mail_wall oe_view_manager_current">
        <table class="oe_view_manager_header">
          <colgroup>
            <col width="33%"/>
            <col width="33%"/>
            <col width="34%"/>
          </colgroup>
          <tbody>
            <tr class="oe_header_row oe_header_row_top">
                <td colspan="2">
                    <h2 class="oe_view_title">
                        <span class="oe_view_title_text">
                            News Feed
                            <t t-if="widget.options.res_model"> / </t>
                            <t t-if="widget.options.res_model" t-esc="widget.options.res_model"/>
                        </span>
                    </h2>
                </td>
                <td><div class="oe_view_manager_view_search" t-opentag="true"/></td>
            </tr>
            <tr class="oe_header_row">
                <td colspan="2">
                    <button type="button" class="oe_write_full oe_highlight">
                        Compose a new message
                    </button>
                    <button type="button" class="oe_write_onwall" help="Your followers can read this message">
                        Write to your followers
                    </button>
                </td>
            </tr>
          </tbody>
        </table>
        <!-- placeholder for the wall threads -->
        <div class="oe_mail_wall_threads"/>
        <div class="oe_mail_wall_aside">
                <!-- contains currently nothing -->
        </div>
    </div>

    <!--
        display message on the wall when there are no message
        -->
    <t t-name="mail.wall_no_message">
        <div class="oe_wall_no_message">You have no messages</div>
    </t>

    <!--
        record_thread main template
        Template used to display the communication history in documents
        form view.
        -->
    <div t-name="mail.record_thread" class="oe_mail_record_wall">
        <!-- <h4>History and Comments</h4> -->
        <div class="oe_mail_wall_threads">
            <!-- contains the document thread -->
        </div>
    </div>

    <t t-name="mail.thread">
        <div t-attf-class="oe_thread #{widget.root?'oe_root_thread':''}"/>
    </t>

    <!-- default layout -->
    <t t-name="mail.thread.message">
        <div t-attf-class="oe_msg oe_with_buttons oe_msg_#{widget.type} oe_msg_#{widget.to_read?'unread':'read'}">
            <!-- message actions (read/unread, reply, delete...) -->
            <div class='oe_msg_right'>
                <div class="oe_msg_icons">
                    <t t-call="mail.thread.message.star"/>
                    <a t-if="widget.show_read_unread_button" title="Read" class="oe_read oe_e">W</a>
                    <a t-if="widget.show_read_unread_button" title="Set back to unread" class="oe_unread oe_e">h</a>
                    <a t-if="widget.show_reply_button" title="Reply" class="oe_reply oe_e">)</a>
                </div>
            </div>

            <div class='oe_msg_left'>
                <a t-attf-href="#model=res.partner&amp;id=#{widget.author_id[0]}" t-att-title="widget.author_id[1]">
                    <img class="oe_msg_icon" t-att-src="widget.avatar"/>
                </a>
            </div>

            <div class="oe_msg_center">
                <!-- message itself -->
                <div class="oe_msg_content">
                    <h1 t-if="widget.subject" class="oe_msg_title">
                        <t t-raw="widget.subject"/>
                    </h1>
                    <div class="oe_msg_body">
                        <t t-if="widget.options.show_record_name and widget.record_name and (!widget.subject) and !widget.options.thread_level and !widget.options.display_on_thread[0] and widget.model!='res.partner'">
                            <a class="oe_mail_action_model" t-attf-href="#model=#{widget.model}&amp;id=#{widget.res_id}"><t t-raw="widget.record_name"/></a>
                        </t>
                        <t t-raw="widget.body"/>
                    </div>
                    <t t-if="widget.attachment_ids.length > 0">
                        <t t-call="mail.thread.message.attachments"/>
                    </t>
                </div>
                <div class="oe_msg_footer">
                    <a t-if="widget.author_id" t-attf-href="#model=res.partner&amp;id=#{widget.author_id[0]}"><t t-raw="widget.author_id[1]"/></a>
                    <span t-att-title="widget.date"><t t-raw="widget.timerelative"/></span>
                        <a t-if="widget.attachment_ids.length > 0" class="oe_mail_msg_view_attachments">
                            <t t-if="widget.attachment_ids.length == 1">1 Attachment</t>
                            <t t-if="widget.attachment_ids.length > 1"><t t-raw="widget.attachment_ids.length"/> Attachments</t>
                        </a>
                    <t t-call="mail.thread.message.vote"/>
                </div>
            </div>
        </div>
    </t>

    <!-- expandable message layout -->
    <t t-name="mail.thread.expandable">
        <div t-attf-class="oe_msg oe_msg_#{widget.type} oe_msg_unread">
            <div class="oe_msg_content oe_msg_more_message">
                <a class="oe_msg_fetch_more">Load more messages <span t-if="widget.nb_messages>0">(<t t-raw="widget.nb_messages"/> messages not display)</span>...</a>
            </div>
        </div>
    </t>

    <!--
        mail.compose_message.button_top_bar
        render of the button on the user bar for open wizard compose message
        -->
    <t t-name="mail.compose_message.button_top_bar">
        <div class="oe_topbar_compose_full_email">
            <!-- <button class="oe_button oe_highlight">Write an email</button> -->
        </div>
    </t>

    <!-- mail.thread.message.vote
        Template used to display Like/Unlike in a mail.message
    -->
    <span t-name="mail.thread.message.vote">
        <span class="oe_left oe_mail_vote_count">
            <t t-if='widget.has_voted'>
                You
            </t>
            <t t-if='(widget.vote_nb - (widget.has_voted ? 1 : 0)) > 0'>
                <t t-if='widget.has_voted'> and </t>
                <t t-esc="widget.vote_nb"/> people
            </t>
            <t t-if='(widget.vote_nb - (widget.has_voted ? 1 : 0)) > 0'>
                <t t-raw="(widget.vote_nb - (widget.has_voted ? 1 : 0))"/>
                concur
            </t>
        </span>
        <button t-attf-class="oe_msg_vote oe_tag">
            <span>
                <t t-if="!widget.has_voted">Concur</t>
                <t t-if="widget.has_voted">Respectfully disagree</t>
            </span>
        </button>
    </span>

    <!-- mail.thread.message.star
        Template used to display stared/unstared message in a mail.message
    -->
    <t t-name="mail.thread.message.star">
         <a t-attf-class="oe_mail_starbox #{widget.has_stared?'oe_stared':''}">*</a>
    </t>
</template>
