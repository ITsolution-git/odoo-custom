<?xml version="1.0" encoding="utf-8"?>
<odoo>
        <record id="project_issue_view_pivot" model="ir.ui.view">
            <field name="name">project.issue.pivot</field>
            <field name="model">project.issue</field>
            <field name="arch" type="xml">
                <pivot string="Project Issue" disable_linking="True">
                    <field name="project_id" type="row"/>
                    <field name="create_date" interval="month" type="col"/>
                </pivot>
            </field>
        </record>

        <record id="project_issue_view_graph" model="ir.ui.view">
            <field name="name">project.issue.graph</field>
            <field name="model">project.issue</field>
            <field name="arch" type="xml">
                <graph string="Project Issue">
                    <field name="project_id" type="row"/>
                    <field name="create_date" interval="month" type="col"/>
                </graph>
            </field>
        </record>

        <record id="project_issue_view_search" model="ir.ui.view">
            <field name="name">project.issue.search</field>
            <field name="model">project.issue</field>
            <field name="arch" type="xml">
                <search string="Search">
                    <field name="project_id"/>
                    <field name="user_id"/>
                    <field name="partner_id" filter_domain="[('partner_id', 'child_of', self)]"/>
                    <field name="stage_id"/>
                    <filter string="Unassigned" name="unassigned" domain="[('user_id','=',False)]"/>
                    <group  expand="1" string="Group By">
                        <filter string="Assigned to" name="Responsible" context="{'group_by':'user_id'}" />
                        <filter string="Project" name="project" context="{'group_by':'project_id'}" />
                        <filter string="Priority" context="{'group_by':'priority'}" />
                        <filter string="Stage" context="{'group_by':'stage_id'}"/>
                        <filter string="Company" context="{'group_by':'company_id'}" groups="base.group_multi_company"/>
                        <separator/>
                        <filter string="Create Day" context="{'group_by':'create_date:day'}" help="Create Date"/>
                   </group>
               </search>
            </field>
        </record>

        <record id="project_issue_action_analysis" model="ir.actions.act_window">
            <field name="name">Issues Analysis</field>
            <field name="res_model">project.issue</field>
            <field name="view_type">form</field>
            <field name="view_mode">graph,pivot</field>
            <field name="context">{'search_default_year':1,'search_default_This Month':1,'search_default_project':1}</field>
            <field name="search_view_id" ref="project_issue_view_search"/>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'pivot', 'view_id': ref('project_issue_view_pivot')}),
                (0, 0, {'view_mode': 'graph', 'view_id': ref('project_issue_view_graph')})]"/>
            <field name="help">This report on the project issues allows you to analyse the quality of your support or after-sales services. You can track the issues per age. You can analyse the time required to open or close an issue, the number of email to exchange and the time spent on average by issues.</field>
        </record>

        <!-- Custom reports (aka filters) -->
        <record id="project_issue_filter_delay" model="ir.filters">
            <field name="name">Delay</field>
            <field name="model_id">project.issue</field>
            <field name="user_id" eval="False"/>
            <field name="action_id" ref="project_issue_action_analysis"/>
            <field name="context">{'group_by': ['project_id'], 'measures': ['delay_close', 'delay_open']}</field>
        </record>
        <record id="project_issue_filter_responsible" model="ir.filters">
            <field name="name">By Responsible</field>
            <field name="model_id">project.issue</field>
            <field name="user_id" eval="False"/>
            <field name="action_id" ref="project_issue_action_analysis"/>
            <field name="context">{'group_by': ['project_id', 'user_id']}</field>
        </record>

        <record id="action_project_issue_report_filtered" model="ir.actions.act_window">
            <field name="name">Issues Analysis</field>
            <field name="res_model">project.issue</field>
            <field name="view_type">form</field>
            <field name="view_mode">graph,pivot</field>
            <field name="context">{
                'search_default_year':1,
                'search_default_This Month':1,
                'search_default_project':1,
                'search_default_project_id': [active_id],
                'default_project_id': active_id,
            }
            </field>
            <field name="search_view_id" ref="project_issue_view_search"/>
            <field name="view_id"></field>  <!-- force empty -->
            <field name="help">This report on the project issues allows you to analyse the quality of your support or after-sales services. You can track the issues per age. You can analyse the time required to open or close an issue, the number of email to exchange and the time spent on average by issues.</field>
        </record>

        <menuitem id="menu_project_issue_report_tree" action="project_issue_action_analysis"
            parent="project.menu_project_report" sequence="20"/>
</odoo>
