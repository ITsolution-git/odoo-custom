<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
 <!-- Report for project issue -->
        <record id="view_project_issue_report_tree" model="ir.ui.view">
            <field name="name">project.issue.report.tree</field>
            <field name="model">project.issue.report</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Project Issue">
                    <field name="name" invisible="1"/>
                    <field name="month" invisible="1"/>
                    <field name="project_id" invisible="1"/>
                    <field name="stage_id" invisible="1"/>
                    <field name="type_id" string="Type" invisible="1"/>
                    <field name="priority" invisible="1"/>
                    <field name="company_id" invisible="1" groups="base.group_multi_company"/>
                    <field name="delay_close" invisible="1"/>
                    <field name="section_id" invisible="1"/>
                    <field name="user_id" invisible="1"/>
                    <field name="categ_id" invisible="1"/>
                    <field name="canal_id" invisible="1"/>
                    <field name="partner_id" invisible="1"/>
                    <field name="task_id" invisible="1"/>
                    <field name="assigned_to" invisible="1"/>
                    <field name="date_closed" invisible="1"/>
                    <field name="create_date" invisible="1"/>
                    <field name="state" invisible="1"/>
                    <field name="nbr" string="#Project Issue"/>
                  </tree>
            </field>
        </record>
        <record id="view_project_issue_report_graph" model="ir.ui.view">
            <field name="name">project.issue.report.graph</field>
            <field name="model">project.issue.report</field>
            <field name="type">graph</field>
            <field name="arch" type="xml">
                <graph orientation="horizontal" string="Project Issue" type="bar">
                    <field name="state"/>
                    <field name="nbr" operator="+"/>
                    <field group="True" name="user_id"/>
                </graph>
            </field>
        </record>
        <record id="view_project_issue_report_filter" model="ir.ui.view">
            <field name="name">project.issue.report.select</field>
            <field name="model">project.issue.report</field>
            <field name="inherit_id" ref="crm.view_crm_case_filter"/>
            <field name="type">search</field>
            <field name="arch" type="xml">
               <data>
                <xpath expr='//search[@string="Search"]/group[1]/filter[@string="This Year"]' position='replace'>
                    	<filter string="This Year" icon="terp-sale" domain="[('create_date','&lt;=', time.strftime('%%Y-%%m-%%d')), ('create_date','&gt;',(datetime.date.today()-datetime.timedelta(days=365)).strftime('%%Y-%%m-%%d'))]"/>
           		</xpath>
            	<xpath expr='//search[@string="Search"]/group[1]/filter[@string="This Month"]' position='replace'>
                    	<filter string="This Month" icon="terp-sale" name="This Month"
                    	domain="[('create_date','&lt;=', time.strftime('%%Y-%%m-%%d')), ('create_date','&gt;',(datetime.date.today()-datetime.timedelta(days=30)).strftime('%%Y-%%m-%%d'))]"/>
						<filter icon="gtk-media-rewind" string="7 Days" separator="1"
                            domain="[('create_date','&lt;=', time.strftime('%%Y-%%m-%%d')), ('create_date','&gt;',(datetime.date.today()-datetime.timedelta(days=7)).strftime('%%Y-%%m-%%d'))]"
                            help="Project isuue last 7 days"/>
            	</xpath>
            	<xpath expr='//search[@string="Search"]/group[1]/filter[@string="Done"]' position='replace'>
            	</xpath>
            	<xpath expr='//search[@string="Search"]/group[1]/filter[@string="Current"]' position='replace'>
            	</xpath>
                <xpath expr='//search[@string="Search"]/group[1]/filter[@string="Cancel"]' position='replace'>
                    		<filter icon="terp-sale"
                    		string="Draft"
                    		domain="[('state','=','draft')]"/>
					<filter icon="terp-sale"
                    		string="Open"
                    		domain="[('state','=','open')]"/>
					<filter icon="terp-sale"
                    		string="Pending"
                    		domain="[('state','=','pending')]"/>
            	</xpath>
               	<xpath expr='//search[@string="Search"]/group[@string="Group By..."]' position='before'>
               	       <newline/>
                		<group  string="Extended options..." colspan="10" col="12">
                		<filter icon="terp-sale"
                    		string="Done"
                    		domain="[('state','=','done')]"/>
                    		<filter icon="terp-sale"
                    		string="Cancel"
                    		domain="[('state','=','cancel')]"/>
                    		<separator orientation="vertical"/>
                  			<field name="project_id" widget="selection" />
                    		<field name="priority" />
                    		<separator orientation="vertical"/>
                    		<field name="type_id" widget="selection" domain="[('object_id.model', '=', 'project.issue')]"/>
                    		<field name="task_id" widget="selection"/>
                    		<separator orientation="vertical"/>
                    		<field name="assigned_to" widget="selection">
                    			<filter icon="terp-crm"  help = "Project Issue Assigned To Me" domain="[('assigned_to','=',uid)]" />
 						    	<filter icon="terp-crm"  help="Non Assigned Project Issue"  domain="[('assigned_to','=',False)]"/>
                    		</field>
                    		<newline/>
                    		<field name="categ_id" widget="selection" domain="[('object_id.model', '=', 'project.issue')]"/>
                    		<field name="stage_id" widget="selection" domain="[('object_id.model', '=', 'project.issue')]" />
                    		<separator orientation="vertical"/>
                    		<field name="partner_id" widget="selection" />
                    		<field name="canal_id" widget="selection"/>
                            <separator orientation="vertical"/>
                            <field name="date_closed" string="Date Closed"/>
                		</group>
                		<newline/>
				</xpath>
				<xpath expr='//search[@string="Search"]/group[@string="Group By..."]/filter[@string="Company"]' position='replace'>
					<filter string="Company" icon="terp-sale" domain="[]" context="{'group_by':'company_id'}"/>
            	</xpath>
				<xpath expr='//search[@string="Search"]/group[@string="Group By..."]/filter[@string="Category"]' position='after'>
            		<filter string="Stage" icon="terp-sale" domain="[]" context="{'group_by':'stage_id'}"/>
            		<separator orientation="vertical"/>
            		<filter string="Project"  icon="terp-sale" domain="[]" context="{'group_by':'project_id'}" />
            		<filter string="Priority"  icon="terp-sale" domain="[]" context="{'group_by':'priority'}" />
            		<separator orientation="vertical"/>
            		<filter string="Type"  icon="terp-sale" domain="[]" context="{'group_by':'type_id'}"/>
            		<filter string="Task"  icon="terp-sale" domain="[]" context="{'group_by':'task_id'}"/>
            		<newline/>
            		<filter string="Assigned To"  icon="terp-sale" domain="[]" context="{'group_by':'assigned_to'}"/>
            		<filter string="Partner"  icon="terp-sale" domain="[]" context="{'group_by':'partner_id'}"/>
            		<filter string="Channel"  icon="terp-sale" domain="[]" context="{'group_by':'canal_id'}"/>
            	</xpath>
                </data>
            </field>
        </record>

        <record id="action_project_issue_report" model="ir.actions.act_window">
            <field name="name">Project Issue</field>
            <field name="res_model">project.issue.report</field>
            <field name="view_type">form</field>
  			<field name="view_mode">graph,tree</field>
  			<field name="context">{"search_default_This Month":1,"search_default_User":1,'group_by_no_leaf':1,'group_by':[]}</field>
            <field name="view_id" ref="view_project_issue_report_tree"/>
            <field name="search_view_id" ref="view_project_issue_report_filter"/>
        </record>


       	<record model="ir.actions.act_window.view" id="action_project_issue_report_tree">
	        <field name="sequence" eval="1"/>
	        <field name="view_mode">tree</field>
	        <field name="view_id" ref="view_project_issue_report_tree"/>
	        <field name="act_window_id" ref="action_project_issue_report"/>
	    </record>
        <record model="ir.actions.act_window.view" id="action_project_issue_report_graph">
	        <field name="sequence" eval="2"/>
	        <field name="view_mode">graph</field>
	        <field name="view_id" ref="view_project_issue_report_graph"/>
	        <field name="act_window_id" ref="action_project_issue_report"/>
	    </record>
        <menuitem icon="terp-project" id="base.menu_main_pm" name="Project Management" sequence="1"/>
        <menuitem id="base.menu_project_report" name="Reporting" parent="base.menu_main_pm" sequence="50"/>
        <menuitem action="action_project_issue_report" id="menu_project_issue_report_tree" parent="base.menu_project_report"/>


  </data>
</openerp>
